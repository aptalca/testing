{"version":3,"sources":["webpack:///./src/views/SignIn.vue?3a4f","webpack:///./src/utils/getcookie.js","webpack:///src/views/SignIn.vue","webpack:///./src/views/SignIn.vue?ba30","webpack:///./src/views/SignIn.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","loading","GET_PLEX_AUTH_TOKEN","IS_USER_AUTHORIZED","_v","_e","allowSignIn","plexAuthUrl","on","authenticate","staticRenderFns","getCookie","name","value","document","cookie","parts","split","length","pop","shift","data","plexAuthResponse","cancelToken","computed","GET_PLEX_AUTH_URL","code","redirect","cookieToken","cookieAuth","regularAuth","abort","methods","fetchInitialAuthCode","token","SET_PLEX_AUTH_TOKEN","FETCH_PLEX_USER","postAuth","console","error","e","FETCH_PLEX_INIT_AUTH","signal","plexAuthChecker","$router","push","$route","query","FETCH_PLEX_DEVICES_IF_NEEDED","FETCH_AND_SET_RANDOM_BACKGROUND_IMAGE","isComplete","isAuthComplete","REQUEST_PLEX_AUTH_TOKEN","id","component","VAlert","VBtn","VCard","VCardActions","VCardTitle","VCol","VContainer","VImg","VRow"],"mappings":"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","file":"js/chunk-2d0c8842-legacy.8575d0ae.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',{staticClass:\"fill-height\"},[_c('v-row',{attrs:{\"align\":\"center\",\"justify\":\"center\"}},[_c('v-col',[_c('v-card',{staticClass:\"mx-auto\",attrs:{\"max-width\":\"550\",\"loading\":_vm.loading}},[(_vm.GET_PLEX_AUTH_TOKEN && _vm.IS_USER_AUTHORIZED === false)?_c('v-alert',{attrs:{\"type\":\"error\"}},[_vm._v(\" You are not authorized to access this server \")]):_vm._e(),_c('v-card-title',[_c('v-img',{attrs:{\"contain\":\"\",\"src\":require(\"@/assets/images/logos/logo-long-light.png\")}})],1),_c('v-card-actions',[_c('v-btn',{staticClass:\"primary\",attrs:{\"target\":\"_blank\",\"x-large\":\"\",\"text\":\"\",\"disabled\":_vm.allowSignIn,\"href\":_vm.plexAuthUrl},on:{\"click\":_vm.authenticate}},[_vm._v(\" Sign in \")])],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// From https://stackoverflow.com/a/15724300\n\nconst getCookie = (name) => {\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n\n  if (parts.length === 2) {\n    return parts.pop().split(';').shift();\n  }\n\n  return null;\n};\n\nexport default getCookie;\n","<template>\n  <v-container class=\"fill-height\">\n    <v-row\n      align=\"center\"\n      justify=\"center\"\n    >\n      <v-col>\n        <v-card\n          class=\"mx-auto\"\n          max-width=\"550\"\n          :loading=\"loading\"\n        >\n          <v-alert\n            v-if=\"GET_PLEX_AUTH_TOKEN && IS_USER_AUTHORIZED === false\"\n            type=\"error\"\n          >\n            You are not authorized to access this server\n          </v-alert>\n\n          <v-card-title>\n            <v-img\n              contain\n              src=\"@/assets/images/logos/logo-long-light.png\"\n            />\n          </v-card-title>\n\n          <v-card-actions>\n            <v-btn\n              class=\"primary\"\n              target=\"_blank\"\n              x-large\n              text\n              :disabled=\"allowSignIn\"\n              :href=\"plexAuthUrl\"\n              @click=\"authenticate\"\n            >\n              Sign in\n            </v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<script>\nimport { mapActions, mapGetters, mapMutations } from 'vuex';\nimport CAF from 'caf';\n\nimport getCookie from '@/utils/getcookie';\n\nexport default {\n  name: 'SignIn',\n\n  data: () => ({\n    loading: false,\n    plexAuthResponse: null,\n    cancelToken: null,\n  }),\n\n  computed: {\n    ...mapGetters([\n      'GET_CONFIG',\n    ]),\n\n    ...mapGetters('plex', [\n      'GET_PLEX_AUTH_URL',\n      'IS_USER_AUTHORIZED',\n      'GET_PLEX_AUTH_TOKEN',\n    ]),\n\n    plexAuthUrl() {\n      if (!this.plexAuthResponse) {\n        return '';\n      }\n\n      return this.GET_PLEX_AUTH_URL(this.plexAuthResponse.code);\n    },\n\n    allowSignIn() {\n      return this.loading || !this.plexAuthResponse\n      || (!this.IS_USER_AUTHORIZED && !!this.GET_PLEX_AUTH_TOKEN);\n    },\n  },\n\n  async created() {\n    if (this.IS_USER_AUTHORIZED && this.GET_PLEX_AUTH_TOKEN) {\n      this.redirect();\n      return;\n    }\n\n    const cookieToken = getCookie('mpt');\n    if (cookieToken) {\n      await this.cookieAuth(cookieToken);\n    } else {\n      await this.regularAuth();\n    }\n  },\n\n  beforeDestroy() {\n    if (this.cancelToken) {\n      this.cancelToken.abort();\n      this.cancelToken = null;\n    }\n  },\n\n  methods: {\n    ...mapActions('plex', [\n      'FETCH_PLEX_INIT_AUTH',\n      'REQUEST_PLEX_AUTH_TOKEN',\n      'FETCH_PLEX_DEVICES_IF_NEEDED',\n      'FETCH_PLEX_USER',\n    ]),\n\n    ...mapActions('plexservers', [\n      'FETCH_AND_SET_RANDOM_BACKGROUND_IMAGE',\n    ]),\n\n    ...mapMutations('plex', [\n      'SET_PLEX_AUTH_TOKEN',\n    ]),\n\n    async regularAuth() {\n      await this.fetchInitialAuthCode();\n    },\n\n    async cookieAuth(token) {\n      // Used by Organizr: https://github.com/causefx/Organizr/issues/1344\n      this.loading = true;\n      this.SET_PLEX_AUTH_TOKEN(token);\n      try {\n        await this.FETCH_PLEX_USER();\n        await this.postAuth();\n        this.loading = false;\n      } catch (e) {\n        console.error(e);\n        // If this fails, then the auth token is probably invalid\n        this.SET_PLEX_AUTH_TOKEN(null);\n        await this.regularAuth();\n      }\n    },\n\n    async fetchInitialAuthCode() {\n      this.loading = true;\n      // eslint-disable-next-line new-cap\n      this.cancelToken = new CAF.cancelToken();\n      this.plexAuthResponse = await this.FETCH_PLEX_INIT_AUTH(this.cancelToken.signal);\n      this.cancelToken = null;\n      this.loading = false;\n    },\n\n    async authenticate() {\n      this.loading = true;\n      // eslint-disable-next-line new-cap\n      this.cancelToken = new CAF.cancelToken();\n      await this.plexAuthChecker(this.cancelToken.signal);\n\n      await this.postAuth();\n      this.loading = false;\n    },\n\n    redirect() {\n      this.$router.push(this.$route.query.redirect || '/');\n    },\n\n    async postAuth() {\n      this.redirect();\n      await this.FETCH_PLEX_DEVICES_IF_NEEDED();\n      await this.FETCH_AND_SET_RANDOM_BACKGROUND_IMAGE();\n    },\n\n    plexAuthChecker: CAF(function* plexAuthChecker(signal) {\n      while (true) {\n        yield CAF.delay(signal, this.GET_CONFIG.plex_auth_check_interval);\n\n        const isComplete = yield this.isAuthComplete(signal);\n        if (isComplete) {\n          return;\n        }\n      }\n    }),\n\n    async isAuthComplete(signal) {\n      try {\n        await this.REQUEST_PLEX_AUTH_TOKEN({\n          signal,\n          id: this.plexAuthResponse.id,\n        });\n\n        return true;\n      } catch {\n        return false;\n      }\n    },\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignIn.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignIn.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SignIn.vue?vue&type=template&id=f3b04378&\"\nimport script from \"./SignIn.vue?vue&type=script&lang=js&\"\nexport * from \"./SignIn.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAlert } from 'vuetify/lib/components/VAlert';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VImg } from 'vuetify/lib/components/VImg';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VAlert,VBtn,VCard,VCardActions,VCardTitle,VCol,VContainer,VImg,VRow})\n"],"sourceRoot":""}