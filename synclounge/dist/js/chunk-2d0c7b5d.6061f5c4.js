(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c7b5d"],{"527a":function(e,t,r){var n,i;
/**
 * libjass
 *
 * https://github.com/Arnavion/libjass
 *
 * Copyright 2013 Arnav Singh
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @license
 */(function(r,o){var a=this;n=[],i=function(){return o(a)}.apply(t,n),void 0===i||(e.exports=i)})(0,(function(e){"use strict";var t=Object.create(null),r=Object.create(null);function n(e,t,n){r[e]={deps:t,body:n}}function i(e){if(e in t)return t[e];var n=t[e]=Object.create(null),o=r[e].deps.map(i);return o.push(n),r[e].body.apply(null,o),n}var o=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};return n("index",["settings","settings","utility/set","utility/set","utility/map","utility/map","utility/promise","utility/promise","webworker/index","parts/index","parser/index","renderers/index","serialization","types/ass","types/attachment","types/dialogue","types/script-properties","types/style","types/misc","version"],(function(e,t,r,n,i,o,a,s,l,u,p,c,h,f,d,_,g,y,v,b,m){function w(t){"boolean"===typeof t.debugMode&&e.setDebugMode(t.debugMode),"boolean"===typeof t.verboseMode&&e.setVerboseMode(t.verboseMode),"function"!==typeof t.Set&&null!==t.Set||r.setImplementation(t.Set),"function"!==typeof t.Map&&null!==t.Map||i.setImplementation(t.Map),"function"!==typeof t.Promise&&null!==t.Promise||a.setImplementation(t.Promise)}m.debugMode=t.debugMode,m.verboseMode=t.verboseMode,m.Set=n.Set,m.Map=o.Map,m.Promise=s.Promise,m.DeferredPromise=s.DeferredPromise,m.webworker=l,m.parts=u,m.parser=p,m.renderers=c,m.serialize=h.serialize,m.deserialize=h.deserialize,m.ASS=f.ASS,m.Attachment=d.Attachment,m.AttachmentType=d.AttachmentType,m.Dialogue=_.Dialogue,m.ScriptProperties=g.ScriptProperties,m.Style=y.Style,m.BorderStyle=v.BorderStyle,m.Format=v.Format,m.WrappingStyle=v.WrappingStyle,m.version=b.version,m.configure=w,Object.defineProperties(m,{debugMode:{get:function(){return e.debugMode},set:function(t){console.warn("Setter `libjass.debugMode = value` has been deprecated. Use `libjass.configure({ debugMode: value })` instead."),e.setDebugMode(t)}},verboseMode:{get:function(){return e.verboseMode},set:function(t){console.warn("Setter `libjass.verboseMode = value` has been deprecated. Use `libjass.configure({ verboseMode: value })` instead."),e.setVerboseMode(t)}},Set:{get:function(){return r.Set},set:function(e){console.warn("Setter `libjass.Set = value` has been deprecated. Use `libjass.configure({ Set: value })` instead."),r.setImplementation(e)}},Map:{get:function(){return i.Map},set:function(e){console.warn("Setter `libjass.Map = value` has been deprecated. Use `libjass.configure({ Map: value })` instead."),i.setImplementation(e)}},Promise:{get:function(){return a.Promise},set:function(e){console.warn("Setter `libjass.Promise = value` has been deprecated. Use `libjass.configure({ Promise: value })` instead."),a.setImplementation(e)}}})})),n("version",[],(function(e){e.version=["0.13.0",0,13,0]})),n("renderers/index",["renderers/clocks/base","renderers/clocks/auto","renderers/clocks/manual","renderers/clocks/video","renderers/default","renderers/null","renderers/web/renderer","renderers/settings"],(function(e,t,r,n,i,o,a,s,l){l.ClockEvent=e.ClockEvent,l.EventSource=e.EventSource,l.AutoClock=t.AutoClock,l.ManualClock=r.ManualClock,l.VideoClock=n.VideoClock,l.DefaultRenderer=i.DefaultRenderer,l.NullRenderer=o.NullRenderer,l.WebRenderer=a.WebRenderer,l.RendererSettings=s.RendererSettings})),n("renderers/default",["renderers/clocks/video","renderers/web/renderer"],(function(e,t,r){var n=function(t){function r(r,n,i){t.call(this,n,new e.VideoClock(r),document.createElement("div"),i),this._video=r,this._video.parentElement.replaceChild(this.libjassSubsWrapper,this._video),this.libjassSubsWrapper.insertBefore(this._video,this.libjassSubsWrapper.firstElementChild)}return a(r,t),r.prototype.resize=function(){var e=this._video.videoWidth,r=this._video.videoHeight,n=this._video.offsetWidth,i=this._video.offsetHeight,o=Math.min(n/e,i/r),a=e*o,s=r*o,l=(n-a)/2,u=(i-s)/2;t.prototype.resize.call(this,a,s,l,u)},r.prototype.resizeVideo=function(){console.warn("`DefaultRenderer.resizeVideo(width, height)` has been deprecated. Use `DefaultRenderer.resize()` instead."),this.resize()},r.prototype._ready=function(){this.resize(),t.prototype._ready.call(this)},r}(t.WebRenderer);r.DefaultRenderer=n})),n("renderers/web/renderer",["parser/ttf","parts/index","settings","types/attachment","types/misc","utility/map","utility/mixin","utility/promise","renderers/clocks/base","renderers/null","renderers/web/animation-collection","renderers/web/drawing-styles","renderers/web/font-size","renderers/web/keyframe","renderers/web/span-styles"],(function(t,r,n,i,o,s,l,u,p,c,h,f,d,_,g,y){var v=/^(url|local)\(["']?(.+?)["']?\)$/,b=function(l){function p(r,o,a,p){var c=this;l.call(this,r,o,function(){if(!(a instanceof HTMLDivElement)){var e=p;p=a,a=e,console.warn("WebRenderer's constructor now takes libjassSubsWrapper as the third parameter and settings as the fourth parameter. Please update the caller.")}return p}()),this._libjassSubsWrapper=a,this._layerWrappers=[],this._layerAlignmentWrappers=[],this._fontMetricsCache=new s.Map,this._currentSubs=new s.Map,this._preRenderedSubs=new s.Map,this._eventListeners=new s.Map,this._libjassSubsWrapper.classList.add("libjass-wrapper"),this._subsWrapper=document.createElement("div"),this._libjassSubsWrapper.appendChild(this._subsWrapper),this._subsWrapper.className="libjass-subs",this._fontSizeElement=document.createElement("div"),this._libjassSubsWrapper.appendChild(this._fontSizeElement),this._fontSizeElement.className="libjass-font-measure",this._fontSizeElement.appendChild(document.createTextNode("M")),n.debugMode&&console.log("Preloading fonts...");var h=[],f=new s.Map,d=null===this.settings.fontMap?new s.Map:this.settings.fontMap,_=new s.Map;this.settings.useAttachedFonts&&r.attachments.forEach((function(e){if(e.type===i.AttachmentType.Font){var r;try{r=t.getTtfNames(e)}catch(o){return void console.error(o)}var n="data:application/x-font-ttf;base64,"+e.contents;r.forEach((function(e){var t=d.get(e);if(void 0!==t)if("string"!==typeof t)t.push(n);else{var r=_.get(e);void 0===r&&_.set(e,r=[]),r.push(n)}else d.set(e,[n])}))}})),d.forEach((function(t,r){var i;if(e.document&&e.document.fonts&&e.document.fonts.add){var o="string"===typeof t?t:t.map((function(e){return null!==e.match(v)?e:'url("'+e+'")'})).join(", "),a=_.get(r);if(void 0!==a)for(var s=0,l=a;s<l.length;s++){var p=l[s];o+=', url("'+p+'")'}var d=[];e.document.fonts.forEach((function(e){e.family!==r&&e.family!=='"'+r+'"'||d.push(e)}));var g=void 0;if(0===d.length){var y=new e.FontFace(r,o),b=new e.FontFace('"'+r+'"',o);e.document.fonts.add(y),e.document.fonts.add(b),g=u.any([y.load(),b.load()])}else g=u.any(d.map((function(e){return e.load()})));i=c._calculateFontMetricsAfterFetch(r,g.catch((function(e){return console.warn("Fetching fonts for "+r+" at "+o+" failed: %o",e),null})))}else{var m=("string"===typeof t?t.split(/,/):t).map((function(e){return e.trim()})).map((function(e){var t=e.match(v);return null===t?e:"local"===t[1]?null:t[2]})).filter((function(e){return null!==e}));a=_.get(r);void 0!==a&&(m=m.concat(a));var w=m.map((function(e){var t=f.get(e);return void 0===t&&(t=new u.Promise((function(t,r){var i=new XMLHttpRequest;i.addEventListener("load",(function(){n.debugMode&&console.log("Preloaded "+e+"."),t(null)})),i.addEventListener("error",(function(e){r(e)})),i.open("GET",e,!0),i.send()})),f.set(e,t)),t})),S=0===w.length?u.Promise.resolve(null):u.first(w).catch((function(e){return console.warn("Fetching fonts for "+r+" at "+m.join(", ")+" failed: %o",e),null}));i=c._calculateFontMetricsAfterFetch(r,S)}h.push(i.then((function(e){return c._fontMetricsCache.set(r,e)})))})),u.Promise.all(h).then((function(){n.debugMode&&console.log("All fonts have been preloaded."),c._ready()}))}return a(p,l),Object.defineProperty(p.prototype,"libjassSubsWrapper",{get:function(){return this._libjassSubsWrapper},enumerable:!0,configurable:!0}),p.prototype.resize=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._removeAllSubs(),this._subsWrapper.style.width=e.toFixed(3)+"px",this._subsWrapper.style.height=t.toFixed(3)+"px",this._subsWrapper.style.left=r.toFixed(3)+"px",this._subsWrapper.style.top=n.toFixed(3)+"px",this._subsWrapperWidth=e,this._scaleX=e/this.ass.properties.resolutionX,this._scaleY=t/this.ass.properties.resolutionY,this._preRenderedSubs.clear(),-1!==this.clock.currentTime&&this._onClockTick()},p.prototype.preRender=function(e){var t=this,i=this.clock.currentTime-e.start;if(e.containsTransformTag&&i<0)return null;var a=this._preRenderedSubs.get(e.id);if(a)return a;var l=document.createElement("div");l.style.marginLeft=(this._scaleX*e.style.marginLeft).toFixed(3)+"px",l.style.marginRight=(this._scaleX*e.style.marginRight).toFixed(3)+"px",l.style.marginTop=l.style.marginBottom=(this._scaleY*e.style.marginVertical).toFixed(3)+"px",l.style.minWidth=(this._subsWrapperWidth-this._scaleX*(e.style.marginLeft+e.style.marginRight)).toFixed(3)+"px";var u=document.createElement("style");u.id="libjass-animation-styles-"+this.id+"-"+e.id,u.type="text/css";var c=new h.AnimationCollection(this,u),d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("version","1.1"),d.setAttribute("class","libjass-filters"),d.width.baseVal.valueAsString="0",d.height.baseVal.valueAsString="0";var y=document.createElementNS("http://www.w3.org/2000/svg","defs");d.appendChild(y);var v=null,b=new g.SpanStyles(this,e,this._scaleX,this._scaleY,this.settings,this._fontSizeElement,y,this._fontMetricsCache),m=null,w=!1,S=function(e){null!==v&&v.hasChildNodes()&&l.appendChild(b.setStylesOnSpan(v,m)),null!==m&&m.animationDelays.forEach((function(e,t){return c.animationDelays.set(t,e)})),e&&(w?l.appendChild(b.makeNewLine()):l.appendChild(document.createElement("br"))),v=document.createElement("span"),m=new h.AnimationCollection(t,u),w=e};S(!1);for(var k=new f.DrawingStyles(this._scaleX,this._scaleY),O=this.ass.properties.wrappingStyle,C=0,x=0,P=e.parts;x<P.length;x++){var E=P[x];if(E instanceof r.Italic)b.italic=E.value;else if(E instanceof r.Bold)b.bold=E.value;else if(E instanceof r.Underline)b.underline=E.value;else if(E instanceof r.StrikeThrough)b.strikeThrough=E.value;else if(E instanceof r.Border)b.outlineWidth=E.value,b.outlineHeight=E.value;else if(E instanceof r.BorderX)b.outlineWidth=E.value;else if(E instanceof r.BorderY)b.outlineHeight=E.value;else if(E instanceof r.Shadow)b.shadowDepthX=E.value,b.shadowDepthY=E.value;else if(E instanceof r.ShadowX)b.shadowDepthX=E.value;else if(E instanceof r.ShadowY)b.shadowDepthY=E.value;else if(E instanceof r.Blur)b.blur=E.value;else if(E instanceof r.GaussianBlur)b.gaussianBlur=E.value;else if(E instanceof r.FontName)b.fontName=E.value;else if(E instanceof r.FontSize)b.fontSize=E.value;else if(E instanceof r.FontSizePlus)b.fontSize*=1+E.value;else if(E instanceof r.FontSizeMinus)b.fontSize*=1-E.value;else if(E instanceof r.FontScaleX)b.fontScaleX=E.value;else if(E instanceof r.FontScaleY)b.fontScaleY=E.value;else if(E instanceof r.LetterSpacing)b.letterSpacing=E.value;else if(E instanceof r.RotateX)b.rotationX=E.value;else if(E instanceof r.RotateY)b.rotationY=E.value;else if(E instanceof r.RotateZ)b.rotationZ=E.value;else if(E instanceof r.SkewX)b.skewX=E.value;else if(E instanceof r.SkewY)b.skewY=E.value;else if(E instanceof r.PrimaryColor)b.primaryColor=E.value;else if(E instanceof r.SecondaryColor)b.secondaryColor=E.value;else if(E instanceof r.OutlineColor)b.outlineColor=E.value;else if(E instanceof r.ShadowColor)b.shadowColor=E.value;else if(E instanceof r.Alpha)b.primaryAlpha=E.value,b.secondaryAlpha=E.value,b.outlineAlpha=E.value,b.shadowAlpha=E.value;else if(E instanceof r.PrimaryAlpha)b.primaryAlpha=E.value;else if(E instanceof r.SecondaryAlpha)b.secondaryAlpha=E.value;else if(E instanceof r.OutlineAlpha)b.outlineAlpha=E.value;else if(E instanceof r.ShadowAlpha)b.shadowAlpha=E.value;else if(E instanceof r.Alignment);else if(E instanceof r.ColorKaraoke)S(!1),m.add("step-end",[new _.Keyframe(0,new s.Map([["color",b.secondaryColor.withAlpha(b.secondaryAlpha).toString()]])),new _.Keyframe(C,new s.Map([["color",b.primaryColor.withAlpha(b.primaryAlpha).toString()]]))]),C+=E.duration;else if(E instanceof r.WrappingStyle)O=E.value;else if(E instanceof r.Reset){var j=E.value;null===j?b.reset(null):b.reset(this.ass.styles.get(j))}else if(E instanceof r.Position)l.style.position="absolute",l.style.left=(this._scaleX*E.x).toFixed(3)+"px",l.style.top=(this._scaleY*E.y).toFixed(3)+"px";else if(E instanceof r.Move)l.style.position="absolute",c.add("linear",[new _.Keyframe(0,new s.Map([["left",(this._scaleX*E.x1).toFixed(3)+"px"],["top",(this._scaleY*E.y1).toFixed(3)+"px"]])),new _.Keyframe(E.t1,new s.Map([["left",(this._scaleX*E.x1).toFixed(3)+"px"],["top",(this._scaleY*E.y1).toFixed(3)+"px"]])),new _.Keyframe(E.t2,new s.Map([["left",(this._scaleX*E.x2).toFixed(3)+"px"],["top",(this._scaleY*E.y2).toFixed(3)+"px"]])),new _.Keyframe(e.end-e.start,new s.Map([["left",(this._scaleX*E.x2).toFixed(3)+"px"],["top",(this._scaleY*E.y2).toFixed(3)+"px"]]))]);else if(E instanceof r.Fade){var A=[];0!==E.start&&A.push(new _.Keyframe(0,new s.Map([["opacity","0"]]))),A.push(new _.Keyframe(E.start,new s.Map([["opacity","1"]])),new _.Keyframe(e.end-e.start-E.end,new s.Map([["opacity","1"]]))),0!==E.end&&A.push(new _.Keyframe(e.end-e.start,new s.Map([["opacity","0"]]))),c.add("linear",A)}else if(E instanceof r.ComplexFade)c.add("linear",[new _.Keyframe(0,new s.Map([["opacity",E.a1.toFixed(3)]])),new _.Keyframe(E.t1,new s.Map([["opacity",E.a1.toFixed(3)]])),new _.Keyframe(E.t2,new s.Map([["opacity",E.a2.toFixed(3)]])),new _.Keyframe(E.t3,new s.Map([["opacity",E.a2.toFixed(3)]])),new _.Keyframe(E.t4,new s.Map([["opacity",E.a3.toFixed(3)]])),new _.Keyframe(e.end-e.start,new s.Map([["opacity",E.a3.toFixed(3)]]))]);else if(E instanceof r.Transform)for(var F=i<=E.start?0:i>=E.end?1:Math.pow((i-E.start)/(E.end-E.start),E.accel),T=0,M=E.tags;T<M.length;T++){var D=M[T];D instanceof r.Border?null!==D.value?(b.outlineWidth+=F*(D.value-b.outlineWidth),b.outlineHeight+=F*(D.value-b.outlineHeight)):(b.outlineWidth=null,b.outlineHeight=null):D instanceof r.BorderX?null!==D.value?b.outlineWidth+=F*(D.value-b.outlineWidth):b.outlineWidth=null:D instanceof r.BorderY?null!==D.value?b.outlineHeight+=F*(D.value-b.outlineHeight):b.outlineHeight=null:D instanceof r.Shadow?null!==D.value?(b.shadowDepthX+=F*(D.value-b.shadowDepthX),b.shadowDepthY+=F*(D.value-b.shadowDepthY)):(b.shadowDepthX=null,b.shadowDepthY=null):D instanceof r.ShadowX?null!==D.value?b.shadowDepthX+=F*(D.value-b.shadowDepthX):b.shadowDepthX=null:D instanceof r.ShadowY?null!==D.value?b.shadowDepthY+=F*(D.value-b.shadowDepthY):b.shadowDepthY=null:D instanceof r.Blur?null!==D.value?b.blur+=F*(D.value-b.blur):b.blur=null:D instanceof r.GaussianBlur?null!==D.value?b.gaussianBlur+=F*(D.value-b.gaussianBlur):b.gaussianBlur=null:D instanceof r.FontSize?null!==D.value?b.fontSize+=F*(D.value-b.fontSize):b.fontSize=null:D instanceof r.FontSizePlus?b.fontSize*=1+F*D.value:D instanceof r.FontSizeMinus?b.fontSize*=1-F*D.value:D instanceof r.FontScaleX?null!==D.value?b.fontScaleX+=F*(D.value-b.fontScaleX):b.fontScaleX=null:D instanceof r.FontScaleY?null!==D.value?b.fontScaleY+=F*(D.value-b.fontScaleY):b.fontScaleY=null:D instanceof r.LetterSpacing?null!==D.value?b.letterSpacing+=F*(D.value-b.letterSpacing):b.letterSpacing=null:D instanceof r.RotateX?null!==D.value?b.rotationX+=F*(D.value-b.rotationX):b.rotationX=null:D instanceof r.RotateY?null!==D.value?b.rotationY+=F*(D.value-b.rotationY):b.rotationY=null:D instanceof r.RotateZ?null!==D.value?b.rotationZ+=F*(D.value-b.rotationZ):b.rotationZ=null:D instanceof r.SkewX?null!==D.value?b.skewX+=F*(D.value-b.skewX):b.skewX=null:D instanceof r.SkewY?null!==D.value?b.skewY+=F*(D.value-b.skewY):b.skewY=null:D instanceof r.PrimaryColor?null!==D.value?b.primaryColor=b.primaryColor.interpolate(D.value,F):b.primaryColor=null:D instanceof r.SecondaryColor?null!==D.value?b.secondaryColor=b.secondaryColor.interpolate(D.value,F):b.secondaryColor=null:D instanceof r.OutlineColor?null!==D.value?b.outlineColor=b.outlineColor.interpolate(D.value,F):b.outlineColor=null:D instanceof r.ShadowColor?null!==D.value?b.shadowColor=b.shadowColor.interpolate(D.value,F):b.shadowColor=null:D instanceof r.Alpha?null!==D.value?(b.primaryAlpha+=F*(D.value-b.primaryAlpha),b.secondaryAlpha+=F*(D.value-b.secondaryAlpha),b.outlineAlpha+=F*(D.value-b.outlineAlpha),b.shadowAlpha+=F*(D.value-b.shadowAlpha)):(b.primaryAlpha=null,b.secondaryAlpha=null,b.outlineAlpha=null,b.shadowAlpha=null):D instanceof r.PrimaryAlpha?null!==D.value?b.primaryAlpha+=F*(D.value-b.primaryAlpha):b.primaryAlpha=null:D instanceof r.SecondaryAlpha?null!==D.value?b.secondaryAlpha+=F*(D.value-b.secondaryAlpha):b.secondaryAlpha=null:D instanceof r.OutlineAlpha?null!==D.value?b.outlineAlpha+=F*(D.value-b.outlineAlpha):b.outlineAlpha=null:D instanceof r.ShadowAlpha&&(null!==D.value?b.shadowAlpha+=F*(D.value-b.shadowAlpha):b.shadowAlpha=null)}else E instanceof r.DrawingMode?0!==E.scale&&(k.scale=E.scale):E instanceof r.DrawingBaselineOffset?k.baselineOffset=E.value:E instanceof r.DrawingInstructions?(v.appendChild(k.toSVG(E,b.primaryColor.withAlpha(b.primaryAlpha))),S(!1)):E instanceof r.Text?(v.appendChild(document.createTextNode(E.value+"‌")),S(!1)):n.debugMode&&E instanceof r.Comment?(v.appendChild(document.createTextNode(E.value)),S(!1)):E instanceof r.NewLine?S(!0):E instanceof r.SoftNewLine&&(O===o.WrappingStyle.NoLineWrapping?S(!0):v.appendChild(document.createTextNode(" ")))}for(var N="",R=p._transformOrigins[e.alignment],W=R[0]+"% "+R[1]+"%",X=0,V=e.parts;X<V.length;X++){E=V[X];if(E instanceof r.Position||E instanceof r.Move){N="translate("+-R[0]+"%, "+-R[1]+"%) translate(-"+l.style.marginLeft+", -"+l.style.marginTop+")";break}}switch(0!==b.rotationY&&(N+=" rotateY("+b.rotationY+"deg)"),0!==b.rotationX&&(N+=" rotateX("+b.rotationX+"deg)"),0!==b.rotationZ&&(N+=" rotateZ("+-1*b.rotationZ+"deg)"),l.style.webkitTransform=N,l.style.transform=N,l.style.webkitTransformOrigin=W,l.style.transformOrigin=W,O){case o.WrappingStyle.EndOfLineWrapping:l.style.whiteSpace="pre-wrap";break;case o.WrappingStyle.NoLineWrapping:l.style.whiteSpace="pre";break;case o.WrappingStyle.SmartWrappingWithWiderTopLine:case o.WrappingStyle.SmartWrappingWithWiderBottomLine:l.style.whiteSpace="pre-wrap";break}if(""!==l.style.position)switch(e.alignment){case 1:case 4:case 7:l.style.textAlign="left";break;case 2:case 5:case 8:l.style.textAlign="center";break;case 3:case 6:case 9:l.style.textAlign="right";break}l.style.webkitAnimation=c.animationStyle,l.style.animation=c.animationStyle,l.setAttribute("data-dialogue-id",this.id+"-"+e.id),""!==u.textContent&&l.appendChild(u),y.hasChildNodes()&&l.appendChild(d);var L={sub:l,animationDelays:c.animationDelays};return e.containsTransformTag||this._preRenderedSubs.set(e.id,L),L},p.prototype.draw=function(e){var t=this;if(!this._currentSubs.has(e)||e.containsTransformTag){n.debugMode&&console.log(e.toString());var r=this._preRenderedSubs.get(e.id);void 0===r&&(r=this.preRender(e),n.debugMode&&console.log(e.toString()));var i=r,o=i.sub.cloneNode(!0),a=function(r){var n=r.style.animationName||r.style.webkitAnimationName||"";if(""!==n){var o=n.split(",").map((function(r){r=r.trim();var n=i.animationDelays.get(r);return((n+e.start-t.clock.currentTime)/t.clock.rate).toFixed(3)+"s"})).join(", ");r.style.webkitAnimationDelay=o,r.style.animationDelay=o}};a(o);for(var s=o.querySelectorAll('[style*="animation:"]'),l=0;l<s.length;l++)a(s[l]);var u=e.layer,p="absolute"===o.style.position?0:e.alignment;if(void 0===this._layerWrappers[u]){var c=document.createElement("div");c.className="layer layer"+u;for(var h=null,f=u+1;f<this._layerWrappers.length&&null===h;f++)void 0!==this._layerWrappers[f]&&(h=this._layerWrappers[f]);this._subsWrapper.insertBefore(c,h),this._layerWrappers[u]=c,this._layerAlignmentWrappers[u]=[]}var d=this._layerAlignmentWrappers[u][p];if(void 0===d){d=this._layerAlignmentWrappers[u][p]=document.createElement("div"),d.className="an an"+p;c=this._layerWrappers[u],h=null;for(var _=p+1;_<this._layerAlignmentWrappers[u].length&&null===h;_++)void 0!==this._layerAlignmentWrappers[u][_]&&(h=this._layerAlignmentWrappers[u][_]);c.insertBefore(d,h)}p>=1&&p<=3?d.insertBefore(o,d.firstElementChild):d.appendChild(o);var g=o.getElementsByTagName("style")[0];if(void 0!==g){var y=g.sheet;0===y.cssRules.length&&(y.cssText=g.textContent)}this._currentSubs.set(e,o)}},p.prototype._onClockPlay=function(){l.prototype._onClockPlay.call(this),this._removeAllSubs(),this._subsWrapper.style.display="",this._subsWrapper.classList.remove("paused")},p.prototype._onClockTick=function(){var e=this,t=this.clock.currentTime;this._currentSubs.forEach((function(r,n){(n.start>t||n.end<t||n.containsTransformTag)&&(e._currentSubs.delete(n),r.parentNode.removeChild(r))})),l.prototype._onClockTick.call(this)},p.prototype._onClockPause=function(){l.prototype._onClockPause.call(this),this._subsWrapper.classList.add("paused")},p.prototype._onClockStop=function(){l.prototype._onClockStop.call(this),this._subsWrapper.style.display="none"},p.prototype._onClockRateChange=function(){l.prototype._onClockRateChange.call(this),this._preRenderedSubs.clear()},p.prototype._ready=function(){this._dispatchEvent("ready",[])},p.prototype._calculateFontMetricsAfterFetch=function(e,t){var r=this;return t.then((function(){var t=r._fontSizeElement.cloneNode(!0);return r._libjassSubsWrapper.appendChild(t),u.lastly(d.calculateFontMetrics(e,r.settings.fallbackFonts,t),(function(){r._libjassSubsWrapper.removeChild(t)}))}))},p.prototype._removeAllSubs=function(){this._currentSubs.forEach((function(e){return e.parentNode.removeChild(e)})),this._currentSubs.clear()},p._transformOrigins=[[],[0,100],[50,100],[100,100],[0,50],[50,50],[100,50],[0,0],[50,0],[100,0]],p}(c.NullRenderer);y.WebRenderer=b,l.mixin(b,[p.EventSource])})),n("renderers/web/span-styles",["renderers/web/font-size"],(function(e,t){var r=function(){function t(e,t,r,n,i,o,a,s){this._scaleX=r,this._scaleY=n,this._settings=i,this._fontSizeElement=o,this._svgDefsElement=a,this._fontMetricsCache=s,this._nextFilterId=0,this._id=e.id+"-"+t.id,this._defaultStyle=t.style,this.reset(null)}return t.prototype.reset=function(e){void 0!==e&&null!==e||(e=this._defaultStyle),this.italic=e.italic,this.bold=e.bold,this.underline=e.underline,this.strikeThrough=e.strikeThrough,this.outlineWidth=e.outlineThickness,this.outlineHeight=e.outlineThickness,this.shadowDepthX=e.shadowDepth,this.shadowDepthY=e.shadowDepth,this.fontName=e.fontName,this.fontSize=e.fontSize,this.fontScaleX=e.fontScaleX,this.fontScaleY=e.fontScaleY,this.letterSpacing=e.letterSpacing,this.rotationX=0,this.rotationY=0,this.rotationZ=e.rotationZ,this.skewX=0,this.skewY=0,this.primaryColor=e.primaryColor,this.secondaryColor=e.secondaryColor,this.outlineColor=e.outlineColor,this.shadowColor=e.shadowColor,this.primaryAlpha=e.primaryColor.alpha,this.secondaryAlpha=e.secondaryColor.alpha,this.outlineAlpha=e.outlineColor.alpha,this.shadowAlpha=e.shadowColor.alpha,this.blur=null,this.gaussianBlur=null},t.prototype.setStylesOnSpan=function(t,r){var n=t.childNodes[0]instanceof Text,i="";this._italic&&(i+="italic "),!0===this._bold?i+="bold ":!1!==this._bold&&(i+=this._bold.toFixed(0)+" ");var o=this._scaleY*(n?this._fontScaleX:1)*this._fontSize,a=e.fontSizeForLineHeight(this._fontName,o,this._settings.fallbackFonts,this._fontSizeElement,this._fontMetricsCache),s=this._fontName;switch(s){case"cursive":case"fantasy":case"monospace":case"sans-serif":case"serif":break;default:s='"'+s+'"';break}""!==this._settings.fallbackFonts&&(s+=", "+this._settings.fallbackFonts),t.style.font=""+i+a.toFixed(3)+"px/"+o.toFixed(3)+"px "+s;var l="";this._underline&&(l="underline"),this._strikeThrough&&(l+=" line-through"),t.style.textDecoration=l.trim();var u="";n?this._fontScaleY!==this._fontScaleX&&(u+="scaleY("+(this._fontScaleY/this._fontScaleX).toFixed(3)+") "):(1!==this._fontScaleX&&(u+="scaleX("+this._fontScaleX+") "),1!==this._fontScaleY&&(u+="scaleY("+this._fontScaleY+") ")),0===this._skewX&&0===this._skewY||(u+="matrix(1, "+this._skewY+", "+this._skewX+", 1, 0, 0) "),""!==u&&(t.style.webkitTransform=u,t.style.webkitTransformOrigin="50% 50%",t.style.transform=u,t.style.transformOrigin="50% 50%",t.style.display="inline-block"),t.style.letterSpacing=(this._scaleX*this._letterSpacing).toFixed(3)+"px";var p=this._scaleX*this._outlineWidth,c=this._scaleY*this._outlineHeight,h=this._scaleX*this._shadowDepthX,f=this._scaleY*this._shadowDepthY,d=this._primaryColor.withAlpha(this._primaryAlpha),_=this._outlineColor.withAlpha(this._outlineAlpha),g=this._shadowColor.withAlpha(this._shadowAlpha);return this._settings.enableSvg||(0!==p||0!==c)&&_.alpha!==d.alpha||(0!==this._shadowDepthX||0!==this._shadowDepthY)&&g.alpha!==d.alpha||(d=this._primaryColor.withAlpha(1),_=this._outlineColor.withAlpha(1),g=this._shadowColor.withAlpha(1),t.style.opacity=this._primaryAlpha.toFixed(3)),t.style.color=d.toString(),this._settings.enableSvg?this._svg(t,p,c,_,h,f,g):this._textShadow(t,p,c,_,h,f,g),0===this._rotationX&&0===this._rotationY||(t.style.display="inline-block"),t.style.webkitAnimation=r.animationStyle,t.style.animation=r.animationStyle,t},t.prototype.makeNewLine=function(){var e=document.createElement("br");return e.style.lineHeight=(this._scaleY*this._fontSize).toFixed(3)+"px",e},t.prototype._svg=function(e,t,r,i,o,a,s){var l=document.createElementNS("http://www.w3.org/2000/svg","filter");if(t>0||r>0||o>0||a>0){var u=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer");l.appendChild(u),u.in1.baseVal="SourceAlpha",u.result.baseVal="source";var p=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");u.appendChild(p),p.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,p.intercept.baseVal=0,p.slope.baseVal=0===this._primaryAlpha?1:1/this._primaryAlpha;var c=document.createElementNS("http://www.w3.org/2000/svg","feMerge");l.appendChild(c),c.result.baseVal="outline-alpha";var h=0,f=!this._settings.preciseOutlines&&this._gaussianBlur>0?this._gaussianBlur:1;(function(e){if(t<=r)if(t>0){var n=void 0;for(n=0;n<=t;n+=f)e(n,r/t*Math.sqrt(t*t-n*n));n!==t+f&&e(t,0)}else e(0,r);else if(r>0){var i=void 0;for(i=0;i<=r;i+=f)e(t/r*Math.sqrt(r*r-i*i),i);i!==r+f&&e(0,r)}else e(t,0)})((function(e,t){var r="outline"+h,n=document.createElementNS("http://www.w3.org/2000/svg","feMorphology");l.insertBefore(n,c),n.in1.baseVal="source",n.operator.baseVal=SVGFEMorphologyElement.SVG_MORPHOLOGY_OPERATOR_DILATE,n.radiusX.baseVal=e,n.radiusY.baseVal=t,n.result.baseVal=r;var i=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");c.appendChild(i),i.in1.baseVal=r,h++})),function(e){t%1>0&&(e(t,0),e(-t,0)),r%1>0&&(e(0,r),e(0,-r))}((function(e,t){var r="outline"+h,n=document.createElementNS("http://www.w3.org/2000/svg","feOffset");l.insertBefore(n,c),n.in1.baseVal="source",n.dx.baseVal=e,n.dy.baseVal=t,n.result.baseVal=r;var i=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");c.appendChild(i),i.in1.baseVal=r,h++}));var d=n(i);if(l.appendChild(d),d.in1.baseVal="outline-alpha",this._gaussianBlur>0){var _=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");l.appendChild(_),_.stdDeviationX.baseVal=this._gaussianBlur,_.stdDeviationY.baseVal=this._gaussianBlur}for(var g=0;g<this._blur;g++){var y=document.createElementNS("http://www.w3.org/2000/svg","feConvolveMatrix");l.appendChild(y),y.setAttribute("kernelMatrix","1 2 1 2 4 2 1 2 1"),y.edgeMode.baseVal=SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE}var v=document.createElementNS("http://www.w3.org/2000/svg","feComposite");if(l.appendChild(v),v.in2.baseVal="source",v.operator.baseVal=SVGFECompositeElement.SVG_FECOMPOSITE_OPERATOR_OUT,v.result.baseVal="outline-colored",o>0||a>0){var b=document.createElementNS("http://www.w3.org/2000/svg","feOffset");l.appendChild(b),b.in1.baseVal="outline-alpha",b.dx.baseVal=o,b.dy.baseVal=a;var m=n(s);l.appendChild(m);var w=m;if(this._gaussianBlur>0){_=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");l.appendChild(_),_.stdDeviationX.baseVal=this._gaussianBlur,_.stdDeviationY.baseVal=this._gaussianBlur,w=_}for(g=0;g<this._blur;g++){y=document.createElementNS("http://www.w3.org/2000/svg","feConvolveMatrix");l.appendChild(y),y.setAttribute("kernelMatrix","1 2 1 2 4 2 1 2 1"),y.edgeMode.baseVal=SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE,w=y}w.result.baseVal="shadow"}var S=document.createElementNS("http://www.w3.org/2000/svg","feMerge");if(l.appendChild(S),o>0||a>0){var k=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");S.appendChild(k),k.in1.baseVal="shadow"}var O=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");S.appendChild(O),O.in1.baseVal="outline-colored";var C=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");S.appendChild(C),C.in1.baseVal="SourceGraphic"}else{if(this._gaussianBlur>0){_=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");l.appendChild(_),_.stdDeviationX.baseVal=this._gaussianBlur,_.stdDeviationY.baseVal=this._gaussianBlur}for(g=0;g<this._blur;g++){y=document.createElementNS("http://www.w3.org/2000/svg","feConvolveMatrix");l.appendChild(y),y.setAttribute("kernelMatrix","1 2 1 2 4 2 1 2 1"),y.edgeMode.baseVal=SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE}}if(l.childElementCount>0){var x="libjass-svg-filter-"+this._id+"-"+this._nextFilterId++;this._svgDefsElement.appendChild(l),l.id=x,l.x.baseVal.valueAsString="-50%",l.width.baseVal.valueAsString="200%",l.y.baseVal.valueAsString="-50%",l.height.baseVal.valueAsString="200%";var P='url("#'+x+'")';e.style.webkitFilter=P,e.style.filter=P}},t.prototype._textShadow=function(e,t,r,n,i,o,a){var s=this;if(t>0||r>0){var l="",u="";(function(e){for(var n=0;n<=t;n++)for(var i=0===t?r:r*Math.sqrt(1-n*n/(t*t)),o=0;o<=i;o++)e(n,o),0!==n&&e(-n,o),0!==o&&e(n,-o),0!==n&&0!==o&&e(-n,-o);t%1>0&&(e(t,0),e(-t,0)),r%1>0&&(e(0,r),e(0,-r))})((function(e,t){l+=", "+n.toString()+" "+e.toFixed(3)+"px "+t.toFixed(3)+"px "+s._gaussianBlur.toFixed(3)+"px",0===s._shadowDepthX&&0===s._shadowDepthY||(u+=", "+a.toString()+" "+(e+i).toFixed(3)+"px "+(t+o).toFixed(3)+"px "+s._gaussianBlur.toFixed(3)+"px")})),e.style.textShadow=(l+u).substr(", ".length)}else if(0!==this._shadowDepthX||0!==this._shadowDepthY){var p=a.toString()+" "+i.toFixed(3)+"px "+o.toFixed(3)+"px 0px";""===e.style.textShadow?e.style.textShadow=p:e.style.textShadow+=", "+p}},Object.defineProperty(t.prototype,"italic",{set:function(e){this._italic=i(e,this._defaultStyle.italic)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bold",{set:function(e){this._bold=i(e,this._defaultStyle.bold)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"underline",{set:function(e){this._underline=i(e,this._defaultStyle.underline)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strikeThrough",{set:function(e){this._strikeThrough=i(e,this._defaultStyle.strikeThrough)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth=i(e,this._defaultStyle.outlineThickness)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineHeight",{get:function(){return this._outlineHeight},set:function(e){this._outlineHeight=i(e,this._defaultStyle.outlineThickness)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowDepthX",{get:function(){return this._shadowDepthX},set:function(e){this._shadowDepthX=i(e,this._defaultStyle.shadowDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowDepthY",{get:function(){return this._shadowDepthY},set:function(e){this._shadowDepthY=i(e,this._defaultStyle.shadowDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blur",{get:function(){return this._blur},set:function(e){this._blur=i(e,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gaussianBlur",{get:function(){return this._gaussianBlur},set:function(e){this._gaussianBlur=i(e,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontName",{set:function(e){this._fontName=i(e,this._defaultStyle.fontName)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize=i(e,this._defaultStyle.fontSize)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontScaleX",{get:function(){return this._fontScaleX},set:function(e){this._fontScaleX=i(e,this._defaultStyle.fontScaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontScaleY",{get:function(){return this._fontScaleY},set:function(e){this._fontScaleY=i(e,this._defaultStyle.fontScaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing=i(e,this._defaultStyle.letterSpacing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationX",{get:function(){return this._rotationX},set:function(e){this._rotationX=i(e,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=i(e,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationZ",{get:function(){return this._rotationZ},set:function(e){this._rotationZ=i(e,this._defaultStyle.rotationZ)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skewX",{get:function(){return this._skewX},set:function(e){this._skewX=i(e,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skewY",{get:function(){return this._skewY},set:function(e){this._skewY=i(e,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryColor",{get:function(){return this._primaryColor},set:function(e){this._primaryColor=i(e,this._defaultStyle.primaryColor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryColor",{get:function(){return this._secondaryColor},set:function(e){this._secondaryColor=i(e,this._defaultStyle.secondaryColor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){this._outlineColor=i(e,this._defaultStyle.outlineColor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(e){this._shadowColor=i(e,this._defaultStyle.shadowColor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryAlpha",{get:function(){return this._primaryAlpha},set:function(e){this._primaryAlpha=i(e,this._defaultStyle.primaryColor.alpha)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryAlpha",{get:function(){return this._secondaryAlpha},set:function(e){this._secondaryAlpha=i(e,this._defaultStyle.secondaryColor.alpha)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineAlpha",{get:function(){return this._outlineAlpha},set:function(e){this._outlineAlpha=i(e,this._defaultStyle.outlineColor.alpha)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowAlpha",{get:function(){return this._shadowAlpha},set:function(e){this._shadowAlpha=i(e,this._defaultStyle.shadowColor.alpha)},enumerable:!0,configurable:!0}),t}();function n(e){var t=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer"),r=document.createElementNS("http://www.w3.org/2000/svg","feFuncR");t.appendChild(r),r.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,r.slope.baseVal=0,r.intercept.baseVal=e.red/255;var n=document.createElementNS("http://www.w3.org/2000/svg","feFuncG");t.appendChild(n),n.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,n.slope.baseVal=0,n.intercept.baseVal=e.green/255;var i=document.createElementNS("http://www.w3.org/2000/svg","feFuncB");t.appendChild(i),i.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,i.slope.baseVal=0,i.intercept.baseVal=e.blue/255;var o=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");return t.appendChild(o),o.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,o.slope.baseVal=e.alpha,o.intercept.baseVal=0,t}function i(e,t){return null!==e?e:t}t.SpanStyles=r})),n("renderers/web/font-size",["utility/promise"],(function(e,t){function r(e,t,r,n){var i='"'+e+'"';""!==r&&(i+=", "+r),n.style.fontFamily=i,n.style.fontSize=t+"px"}function n(t,n,i,o){return r(t,n,i,o),new e.Promise((function(e){return setTimeout((function(){return e(o.offsetHeight)}),1e3)}))}function i(e,t,n,i){return r(e,t,n,i),i.offsetHeight}function o(e,t){return[e,180/(t-e)]}function a(e,t,r){return n(e,180,t,r).then((function(i){return n(e,360,t,r).then((function(e){return o(i,e)}))}))}function s(e,t,r){return 180+(e-t)*r}function l(e,t,r,n,a){var l=a.get(e);if(void 0===l){var u=i(e,180,r,n),p=i(e,360,r,n);a.set(e,l=o(u,p))}var c=l[0],h=l[1];return s(t,c,h)}t.calculateFontMetrics=a,t.fontSizeForLineHeight=l})),n("renderers/web/drawing-styles",["parts/index"],(function(e,t){var r=function(){function t(e,t){this._outputScaleX=e,this._outputScaleY=t,this._scale=1,this._baselineOffset=0}return Object.defineProperty(t.prototype,"scale",{set:function(e){this._scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baselineOffset",{set:function(e){this._baselineOffset=e},enumerable:!0,configurable:!0}),t.prototype.toSVG=function(t,r){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");if(n.setAttribute("version","1.1"),0===t.instructions.length)return n;for(var i=Math.pow(2,this._scale-1),o=this._outputScaleX/i,a=this._outputScaleY/i,s=document.createElementNS("http://www.w3.org/2000/svg","path"),l="",u=1/0,p=-1/0,c=1/0,h=-1/0,f=0,d=t.instructions;f<d.length;f++){var _=d[f];_ instanceof e.drawing.MoveInstruction?(l+=" M "+_.x.toFixed(3)+" "+(_.y+this._baselineOffset).toFixed(3),u=Math.min(u,_.x),p=Math.max(p,_.x),c=Math.min(c,_.y+this._baselineOffset),h=Math.max(h,_.y+this._baselineOffset)):_ instanceof e.drawing.LineInstruction?(l+=" L "+_.x.toFixed(3)+" "+(_.y+this._baselineOffset).toFixed(3),u=Math.min(u,_.x),p=Math.max(p,_.x),c=Math.min(c,_.y+this._baselineOffset),h=Math.max(h,_.y+this._baselineOffset)):_ instanceof e.drawing.CubicBezierCurveInstruction&&(l+=" C "+_.x1.toFixed(3)+" "+(_.y1+this._baselineOffset).toFixed(3)+" "+_.x2.toFixed(3)+" "+(_.y2+this._baselineOffset).toFixed(3)+" "+_.x3.toFixed(3)+" "+(_.y3+this._baselineOffset).toFixed(3),u=Math.min(u,_.x1,_.x2,_.x3),p=Math.max(p,_.x1,_.x2,_.x3),c=Math.min(c,_.y1+this._baselineOffset,_.y2+this._baselineOffset,_.y3+this._baselineOffset),h=Math.max(h,_.y1+this._baselineOffset,_.y2+this._baselineOffset,_.y3+this._baselineOffset))}u*=o,p*=o,c*=a,h*=a;var g=p-u,y=h-c;n.width.baseVal.valueAsString=g.toFixed(3)+"px",n.height.baseVal.valueAsString=y.toFixed(3)+"px",n.setAttribute("viewBox",u+" "+c+" "+g+" "+y),n.style.position="relative",n.style.left=u.toFixed(3)+"px",n.style.top=c.toFixed(3)+"px";var v=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(v),v.setAttribute("transform","scale("+o.toFixed(3)+" "+a.toFixed(3)+")"),v.appendChild(s),s.setAttribute("d",l),s.setAttribute("fill",r.toString()),n},t}();t.DrawingStyles=r})),n("renderers/web/animation-collection",["utility/map"],(function(e,t){var r=function(){function t(r,n){this._style=n,this._animationStyle="",this._animationDelays=new e.Map,this._numAnimations=0,this._id=r.id+"-"+t._nextId++,this._rate=r.clock.rate}return Object.defineProperty(t.prototype,"animationStyle",{get:function(){return this._animationStyle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationDelays",{get:function(){return this._animationDelays},enumerable:!0,configurable:!0}),t.prototype.add=function(e,t){for(var r=null,n=null,i=0,o=t;i<o.length;i++){var a=o[i];null===r&&(r=a.time),n=a.time}if(null===r||null===n)throw new Error("Atleast one keyframe must be provided.");for(var s="",l=0,u=t;l<u.length;l++){a=u[l];s+="\t"+(100*(n-r===0?1:(a.time-r)/(n-r))).toFixed(3)+"% {\n",a.properties.forEach((function(e,t){s+="\t\t"+t+": "+e+";\n"})),s+="\t}\n"}var p="animation-"+this._id+"-"+this._numAnimations++;this._style.appendChild(document.createTextNode("@-webkit-keyframes "+p+" {\n"+s+"\n}")),this._style.appendChild(document.createTextNode("@keyframes "+p+" {\n"+s+"\n}")),""!==this._animationStyle&&(this._animationStyle+=","),this._animationStyle+=p+" "+((n-r)/this._rate).toFixed(3)+"s "+e,this._animationDelays.set(p,r)},t._nextId=0,t}();t.AnimationCollection=r})),n("renderers/web/keyframe",[],(function(e){var t=function(){function e(e,t){this._time=e,this._properties=t}return Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),e}();e.Keyframe=t})),n("renderers/null",["settings","renderers/clocks/base","renderers/settings"],(function(e,t,r,n){var i=function(){function n(e,i,o){var a=this;this._ass=e,this._clock=i,this._id=++n._lastRendererId,this._settings=r.RendererSettings.from(o),this._clock.addEventListener(t.ClockEvent.Play,(function(){return a._onClockPlay()})),this._clock.addEventListener(t.ClockEvent.Tick,(function(){return a._onClockTick()})),this._clock.addEventListener(t.ClockEvent.Pause,(function(){return a._onClockPause()})),this._clock.addEventListener(t.ClockEvent.Stop,(function(){return a._onClockStop()})),this._clock.addEventListener(t.ClockEvent.RateChange,(function(){return a._onClockRateChange()}))}return Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ass",{get:function(){return this._ass},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"settings",{get:function(){return this._settings},enumerable:!0,configurable:!0}),n.prototype.preRender=function(){},n.prototype.draw=function(){},n.prototype.enable=function(){return this._clock.enable()},n.prototype.disable=function(){return this._clock.disable()},n.prototype.toggle=function(){this._clock.toggle()},n.prototype.setEnabled=function(e){return this._clock.setEnabled(e)},Object.defineProperty(n.prototype,"enabled",{get:function(){return this._clock.enabled},enumerable:!0,configurable:!0}),n.prototype._onClockPlay=function(){e.verboseMode&&console.log("NullRenderer._onClockPlay")},n.prototype._onClockTick=function(){var t=this._clock.currentTime;e.verboseMode&&console.log("NullRenderer._onClockTick: currentTime = "+t);for(var r=0,n=this._ass.dialogues;r<n.length;r++){var i=n[r];try{i.end>t&&(i.start<=t?this.draw(i):i.start<=t+this._settings.preRenderTime&&this.preRender(i))}catch(o){e.debugMode&&console.error("Rendering dialogue "+i.id+" failed.",o)}}},n.prototype._onClockPause=function(){e.verboseMode&&console.log("NullRenderer._onClockPause")},n.prototype._onClockStop=function(){e.verboseMode&&console.log("NullRenderer._onClockStop")},n.prototype._onClockRateChange=function(){e.verboseMode&&console.log("NullRenderer._onClockRateChange")},n._lastRendererId=-1,n}();n.NullRenderer=i})),n("parser/ttf",["utility/map","utility/set"],(function(e,t,r){var n;(function(e){e[e["Char"]=0]="Char",e[e["Uint16"]=1]="Uint16",e[e["Uint32"]=2]="Uint32"})(n||(n={}));var i=new e.Map,a=function(){function e(){}return o([h(n.Uint16)],e.prototype,"majorVersion",void 0),o([h(n.Uint16)],e.prototype,"minorVersion",void 0),o([h(n.Uint16)],e.prototype,"numTables",void 0),o([h(n.Uint16)],e.prototype,"searchRange",void 0),o([h(n.Uint16)],e.prototype,"entrySelector",void 0),o([h(n.Uint16)],e.prototype,"rangeShift",void 0),e=o([c],e),e}(),s=function(){function e(){}return o([h(n.Char)],e.prototype,"c1",void 0),o([h(n.Char)],e.prototype,"c2",void 0),o([h(n.Char)],e.prototype,"c3",void 0),o([h(n.Char)],e.prototype,"c4",void 0),o([h(n.Uint32)],e.prototype,"checksum",void 0),o([h(n.Uint32)],e.prototype,"offset",void 0),o([h(n.Uint32)],e.prototype,"length",void 0),e=o([c],e),e}(),l=function(){function e(){}return o([h(n.Uint16)],e.prototype,"formatSelector",void 0),o([h(n.Uint16)],e.prototype,"count",void 0),o([h(n.Uint16)],e.prototype,"stringOffset",void 0),e=o([c],e),e}(),u=function(){function e(){}return o([h(n.Uint16)],e.prototype,"platformId",void 0),o([h(n.Uint16)],e.prototype,"encodingId",void 0),o([h(n.Uint16)],e.prototype,"languageId",void 0),o([h(n.Uint16)],e.prototype,"nameId",void 0),o([h(n.Uint16)],e.prototype,"length",void 0),o([h(n.Uint16)],e.prototype,"offset",void 0),e=o([c],e),e}();function p(e){for(var r=atob(e.contents),n=new Uint8Array(new ArrayBuffer(r.length)),i=0;i<r.length;i++)n[i]=r.charCodeAt(i);var o={dataView:new DataView(n.buffer),position:0},p=a.read(o),c=null;for(i=0;i<p.numTables;i++){var h=s.read(o);if(h.c1+h.c2+h.c3+h.c4==="name"){c=h;break}}if(null===c)throw new Error('Could not find "name" table record.');o.position=c.offset;var f=l.read(o),d=new t.Set;for(i=0;i<f.count;i++){var _=u.read(o);switch(_.nameId){case 1:case 4:case 6:var g=c.offset+f.stringOffset+_.offset,y=n.subarray(g,g+_.length);switch(_.platformId){case 1:for(var v="",b=0;b<y.length;b++)v+=String.fromCharCode(y[b]);d.add(v);break;case 3:var m="";for(b=0;b<y.length;b+=2)m+=String.fromCharCode((y[b]<<8)+y[b+1]);d.add(m);break}break;default:break}}return d}function c(e){var t=e.__fields;return e.read=function(r){for(var i=new e,o=0,a=t;o<a.length;o++){var s=a[o],l=void 0;switch(s.type){case n.Char:l=String.fromCharCode(r.dataView.getInt8(r.position)),r.position+=1;break;case n.Uint16:l=r.dataView.getUint16(r.position),r.position+=2;break;case n.Uint32:l=r.dataView.getUint32(r.position),r.position+=4;break}i[s.field]=l}return i},e}function h(e){var t=i.get(e);return void 0===t&&(t=function(t,r){var n=t.constructor;void 0===n.__fields&&(n.__fields=[]),n.__fields.push({type:e,field:r})},i.set(e,t)),t}r.getTtfNames=p})),n("renderers/settings",["settings","utility/map"],(function(t,r,n){var i=function(){function e(){}return e.makeFontMapFromStyleElement=function(e){for(var t=new r.Map,n=e.sheet,i=0;i<n.cssRules.length;i++){var a=n.cssRules[i];if(o(a)){var s=a.style.getPropertyValue("font-family").match(/^["']?(.*?)["']?$/)[1],l=a.style.getPropertyValue("src");l||(l=a.cssText.split("\n").map((function(e){return e.match(/src:\s*([^;]+?)\s*;/)})).filter((function(e){return null!==e})).map((function(e){return e[1]}))[0]),t.set(s,l)}}return t},e.from=function(t){void 0!==t&&null!==t||(t={});var r=t,n=r.fontMap,i=void 0===n?null:n,o=r.preRenderTime,s=void 0===o?5:o,l=r.preciseOutlines,u=void 0!==l&&l,p=r.enableSvg,c=void 0===p?a():p,h=r.fallbackFonts,f=void 0===h?'Arial, Helvetica, sans-serif, "Segoe UI Symbol"':h,d=r.useAttachedFonts,_=void 0!==d&&d,g=new e;return g.fontMap=i,g.preRenderTime=s,g.preciseOutlines=u,g.enableSvg=c,g.fallbackFonts=f,g.useAttachedFonts=_,g},e}();function o(e){return e.type===CSSRule.FONT_FACE_RULE}function a(){if(t.debugMode&&console.log("Testing whether SVG filter effects are supported."),void 0===e.document)return t.debugMode&&console.log("This doesn't look like a browser. Assuming it doesn't support SVG filter effects."),!1;var r=document.createElementNS("http://www.w3.org/2000/svg","feMorphology");try{r.radiusX.baseVal=1}catch(i){if(t.debugMode)if(i instanceof DOMException){var n=i;n.code===DOMException.NO_MODIFICATION_ALLOWED_ERR?console.log("Setting SVGFEMorphologyElement.radiusX.baseVal threw NoModificationAllowedError. This browser doesn't support SVG DOM correctly."):console.log("Setting SVGFEMorphologyElement.radiusX.baseVal threw unexpected DOMException code "+n.code+". This browser doesn't support SVG DOM correctly.")}else console.log("Setting SVGFEMorphologyElement.radiusX.baseVal threw unexpected exception "+i+". This browser doesn't support SVG SVG DOM correctly.");return!1}return r.setAttribute("radius","1"),"1"!==r.cloneNode().getAttribute("radius")?(t.debugMode&&console.log("SVGFEMorphologyElement's radius attribute was corrupted when cloned. This browser doesn't support SVG DOM correctly."),!1):(t.debugMode&&console.log("This browser may support SVG filter effects."),!0)}n.RendererSettings=i})),n("renderers/clocks/video",["renderers/clocks/auto"],(function(e,t){var r=function(){function t(t){var r=this;this._autoClock=new e.AutoClock((function(){return t.currentTime}),100),t.addEventListener("playing",(function(){return r._autoClock.play()}),!1),t.addEventListener("pause",(function(){return r._autoClock.pause()}),!1),t.addEventListener("seeking",(function(){return r._autoClock.seeking()}),!1),t.addEventListener("ratechange",(function(){return r._autoClock.setRate(t.playbackRate)}),!1)}return Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._autoClock.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._autoClock.enabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._autoClock.paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rate",{get:function(){return this._autoClock.rate},enumerable:!0,configurable:!0}),t.prototype.enable=function(){return this._autoClock.enable()},t.prototype.disable=function(){return this._autoClock.disable()},t.prototype.toggle=function(){this._autoClock.enabled?this.disable():this.enable()},t.prototype.setEnabled=function(e){return e?this.enable():this.disable()},t.prototype.addEventListener=function(e,t){this._autoClock.addEventListener(e,t)},t}();t.VideoClock=r})),n("renderers/clocks/auto",["settings","renderers/clocks/manual"],(function(e,t,r){var n=function(){function r(e,r){this._getCurrentTime=e,this._autoPauseAfter=r,this._manualClock=new t.ManualClock,this._nextAnimationFrameRequestId=null,this._lastKnownExternalTime=null,this._lastKnownExternalTimeObtainedAt=0}return r.prototype.play=function(){this._manualClock.enabled&&(this._startTicking(),this._manualClock.play())},r.prototype.pause=function(){this._manualClock.enabled&&(null!==this._nextAnimationFrameRequestId?(this._stopTicking(),this._manualClock.pause()):e.debugMode&&console.warn("AutoClock.pause: Abnormal state detected. AutoClock._nextAnimationFrameRequestId should not have been null."))},r.prototype.seeking=function(){this._manualClock.seek(this._getCurrentTime())},Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._manualClock.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"enabled",{get:function(){return this._manualClock.enabled},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paused",{get:function(){return this._manualClock.paused},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rate",{get:function(){return this._manualClock.rate},enumerable:!0,configurable:!0}),r.prototype.setRate=function(e){this._manualClock.setRate(e)},r.prototype.enable=function(){return!!this._manualClock.enable()&&(this._startTicking(),!0)},r.prototype.disable=function(){return!!this._manualClock.disable()&&(this._stopTicking(),!0)},r.prototype.toggle=function(){this._manualClock.enabled?this.disable():this.enable()},r.prototype.setEnabled=function(e){return e?this.enable():this.disable()},r.prototype.addEventListener=function(e,t){this._manualClock.addEventListener(e,t)},r.prototype._onTimerTick=function(t){var r=this;if(this._manualClock.enabled){var n=this._manualClock.currentTime,i=this._getCurrentTime();this._manualClock.paused?n!==i&&(this._lastKnownExternalTime=i,this._lastKnownExternalTimeObtainedAt=t,this._manualClock.tick(i)):null!==this._lastKnownExternalTime&&i===this._lastKnownExternalTime?t-this._lastKnownExternalTimeObtainedAt>this._autoPauseAfter?(this._lastKnownExternalTimeObtainedAt=0,this._manualClock.seek(i)):this._manualClock.tick((t-this._lastKnownExternalTimeObtainedAt)/1e3*this._manualClock.rate+this._lastKnownExternalTime):(this._lastKnownExternalTime=i,this._lastKnownExternalTimeObtainedAt=t,this._manualClock.tick(i)),this._nextAnimationFrameRequestId=requestAnimationFrame((function(e){return r._onTimerTick(e)}))}else e.debugMode&&console.warn("AutoClock._onTimerTick: Called when disabled.")},r.prototype._startTicking=function(){var e=this;null===this._nextAnimationFrameRequestId&&(this._nextAnimationFrameRequestId=requestAnimationFrame((function(t){return e._onTimerTick(t)})))},r.prototype._stopTicking=function(){null!==this._nextAnimationFrameRequestId&&(cancelAnimationFrame(this._nextAnimationFrameRequestId),this._nextAnimationFrameRequestId=null)},r}();r.AutoClock=n})),n("renderers/clocks/manual",["utility/map","utility/mixin","renderers/clocks/base"],(function(e,t,r,n){var i=function(){function t(){this._currentTime=-1,this._rate=1,this._enabled=!0,this._paused=!0,this._eventListeners=new e.Map}return t.prototype.play=function(){this._enabled&&this._paused&&(this._paused=!1,this._dispatchEvent(r.ClockEvent.Play,[]))},t.prototype.tick=function(e){this._enabled&&this._currentTime!==e&&(this.play(),this._currentTime=e,this._dispatchEvent(r.ClockEvent.Tick,[]))},t.prototype.seek=function(e){this._enabled&&(this.pause(),this._currentTime!==e&&(this.stop(),this.tick(e),this.pause()))},t.prototype.pause=function(){this._enabled&&(this._paused||(this._paused=!0,this._dispatchEvent(r.ClockEvent.Pause,[])))},t.prototype.stop=function(){this._dispatchEvent(r.ClockEvent.Stop,[])},Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rate",{get:function(){return this._rate},enumerable:!0,configurable:!0}),t.prototype.setRate=function(e){this._rate!==e&&(this._rate=e,this._dispatchEvent(r.ClockEvent.RateChange,[]))},t.prototype.enable=function(){return!this._enabled&&(this._enabled=!0,!0)},t.prototype.disable=function(){return!!this._enabled&&(this.pause(),this.stop(),this._enabled=!1,!0)},t.prototype.toggle=function(){this._enabled?this.disable():this.enable()},t.prototype.setEnabled=function(e){return e?this.enable():this.disable()},t}();n.ManualClock=i,t.mixin(i,[r.EventSource])})),n("utility/mixin",[],(function(e){function t(e,t){for(var r=0,n=t;r<n.length;r++)for(var i=n[r],o=0,a=Object.getOwnPropertyNames(i.prototype);o<a.length;o++){var s=a[o];e.prototype[s]=i.prototype[s]}}e.mixin=t})),n("renderers/clocks/base",[],(function(e){var t=function(){function e(){}return e.prototype.addEventListener=function(e,t){var r=this._eventListeners.get(e);void 0===r&&this._eventListeners.set(e,r=[]),r.push(t)},e.prototype._dispatchEvent=function(e,t){var r=this._eventListeners.get(e);if(void 0!==r)for(var n=0,i=r;n<i.length;n++){var o=i[n];o.apply(this,t)}},e}();e.EventSource=t,function(e){e[e["Play"]=0]="Play",e[e["Tick"]=1]="Tick",e[e["Pause"]=2]="Pause",e[e["Stop"]=3]="Stop",e[e["RateChange"]=4]="RateChange"}(e.ClockEvent||(e.ClockEvent={}))})),n("parser/index",["parser/parse","parser/streams","parser/stream-parsers"],(function(e,t,r,n){n.parse=e.parse,n.BrowserReadableStream=t.BrowserReadableStream,n.StringStream=t.StringStream,n.XhrStream=t.XhrStream,n.StreamParser=r.StreamParser,n.SrtStreamParser=r.SrtStreamParser})),n("parser/stream-parsers",["settings","types/ass","types/attachment","types/dialogue","types/style","utility/map","utility/promise","parser/misc"],(function(e,t,r,n,i,o,a,s,l){var u;(function(e){e[e["ScriptInfo"]=0]="ScriptInfo",e[e["Styles"]=1]="Styles",e[e["Events"]=2]="Events",e[e["Fonts"]=3]="Fonts",e[e["Graphics"]=4]="Graphics",e[e["Other"]=5]="Other",e[e["EOF"]=6]="EOF"})(u||(u={}));var p=function(){function n(e){var r=this;this._stream=e,this._ass=new t.ASS,this._minimalDeferred=new a.DeferredPromise,this._deferred=new a.DeferredPromise,this._shouldSwallowBom=!0,this._currentSection=u.ScriptInfo,this._currentAttachment=null,this._stream.nextLine().then((function(e){return r._onNextLine(e)}),(function(e){r._minimalDeferred.reject(e),r._deferred.reject(e)}))}return Object.defineProperty(n.prototype,"minimalASS",{get:function(){return this._minimalDeferred.promise},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ass",{get:function(){return this._deferred.promise},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentSection",{get:function(){return this._currentSection},set:function(e){if(null!==this._currentAttachment&&(this._ass.addAttachment(this._currentAttachment),this._currentAttachment=null),this._currentSection===u.ScriptInfo&&e!==u.ScriptInfo&&this._minimalDeferred.resolve(this._ass),e===u.EOF){var t=this._ass.properties;void 0===t.resolutionX||void 0===t.resolutionY?(this._minimalDeferred.reject("Malformed ASS script."),this._deferred.reject("Malformed ASS script.")):(this._minimalDeferred.resolve(this._ass),this._deferred.resolve(this._ass))}this._currentSection=e},enumerable:!0,configurable:!0}),n.prototype._onNextLine=function(t){var n=this;if(null!==t){if("\r"===t[t.length-1]&&(t=t.substr(0,t.length-1)),65279===t.charCodeAt(0)&&this._shouldSwallowBom&&(t=t.substr(1)),this._shouldSwallowBom=!1,""===t);else if(";"===t[0]&&null===this._currentAttachment);else if("[Script Info]"===t)this.currentSection=u.ScriptInfo;else if("[V4+ Styles]"===t||"[V4 Styles]"===t)this.currentSection=u.Styles;else if("[Events]"===t)this.currentSection=u.Events;else if("[Fonts]"===t)this.currentSection=u.Fonts;else if("[Graphics]"===t)this.currentSection=u.Graphics;else switch(null===this._currentAttachment&&"["===t[0]&&"]"===t[t.length-1]&&(this.currentSection=u.Other),this.currentSection){case u.ScriptInfo:var i=s.parseLineIntoProperty(t);if(null!==i)switch(i.name){case"PlayResX":this._ass.properties.resolutionX=parseInt(i.value);break;case"PlayResY":this._ass.properties.resolutionY=parseInt(i.value);break;case"WrapStyle":this._ass.properties.wrappingStyle=parseInt(i.value);break;case"ScaledBorderAndShadow":this._ass.properties.scaleBorderAndShadow="yes"===i.value;break}break;case u.Styles:if(null===this._ass.stylesFormatSpecifier){var o=s.parseLineIntoProperty(t);null!==o&&"Format"===o.name&&(this._ass.stylesFormatSpecifier=o.value.split(",").map((function(e){return e.trim()})))}else try{this._ass.addStyle(t)}catch(c){e.debugMode&&console.error("Could not parse style from line "+t+" - "+(c.stack||c))}break;case u.Events:if(null===this._ass.dialoguesFormatSpecifier){var a=s.parseLineIntoProperty(t);null!==a&&"Format"===a.name&&(this._ass.dialoguesFormatSpecifier=a.value.split(",").map((function(e){return e.trim()})))}else try{this._ass.addEvent(t)}catch(c){e.debugMode&&console.error("Could not parse event from line "+t+" - "+(c.stack||c))}break;case u.Fonts:case u.Graphics:var l=this.currentSection===u.Fonts?/^fontname:(.+)/:/^filename:(.+)/,p=l.exec(t);if(null!==p)null!==this._currentAttachment&&(this._ass.addAttachment(this._currentAttachment),this._currentAttachment=null),this._currentAttachment=new r.Attachment(p[1].trim(),this.currentSection===u.Fonts?r.AttachmentType.Font:r.AttachmentType.Graphic);else if(null!==this._currentAttachment)try{this._currentAttachment.contents+=h(t)}catch(c){e.debugMode&&console.error("Encountered error while reading font "+this._currentAttachment.filename+": %o",c),this._currentAttachment=null}break;case u.Other:break;default:throw new Error("Unhandled state "+this.currentSection)}this._stream.nextLine().then((function(e){return n._onNextLine(e)}),(function(e){n._minimalDeferred.reject(e),n._deferred.reject(e)}))}else this.currentSection=u.EOF},n}();l.StreamParser=p;var c=function(){function e(e){var r=this;this._stream=e,this._ass=new t.ASS,this._deferred=new a.DeferredPromise,this._shouldSwallowBom=!0,this._currentDialogueNumber=null,this._currentDialogueStart=null,this._currentDialogueEnd=null,this._currentDialogueText=null,this._stream.nextLine().then((function(e){return r._onNextLine(e)}),(function(e){r._deferred.reject(e)})),this._ass.properties.resolutionX=1280,this._ass.properties.resolutionY=720,this._ass.properties.wrappingStyle=1,this._ass.properties.scaleBorderAndShadow=!0;var n=new i.Style(new o.Map([["Name","Default"],["FontSize","36"]]));this._ass.styles.set(n.name,n)}return Object.defineProperty(e.prototype,"ass",{get:function(){return this._deferred.promise},enumerable:!0,configurable:!0}),e.prototype._onNextLine=function(e){var t=this;if(null===e)return null!==this._currentDialogueNumber&&null!==this._currentDialogueStart&&null!==this._currentDialogueEnd&&null!==this._currentDialogueText&&this._ass.dialogues.push(new n.Dialogue(new o.Map([["Style","Default"],["Start",this._currentDialogueStart],["End",this._currentDialogueEnd],["Text",this._currentDialogueText]]),this._ass)),void this._deferred.resolve(this._ass);if("\r"===e[e.length-1]&&(e=e.substr(0,e.length-1)),65279===e.charCodeAt(0)&&this._shouldSwallowBom&&(e=e.substr(1)),this._shouldSwallowBom=!1,""===e)null!==this._currentDialogueNumber&&null!==this._currentDialogueStart&&null!==this._currentDialogueEnd&&null!==this._currentDialogueText&&this._ass.dialogues.push(new n.Dialogue(new o.Map([["Style","Default"],["Start",this._currentDialogueStart],["End",this._currentDialogueEnd],["Text",this._currentDialogueText]]),this._ass)),this._currentDialogueNumber=this._currentDialogueStart=this._currentDialogueEnd=this._currentDialogueText=null;else if(null===this._currentDialogueNumber)/^\d+$/.test(e)&&(this._currentDialogueNumber=e);else if(null===this._currentDialogueStart&&null===this._currentDialogueEnd){var r=/^(\d\d:\d\d:\d\d,\d\d\d) --> (\d\d:\d\d:\d\d,\d\d\d)/.exec(e);null!==r&&(this._currentDialogueStart=r[1].replace(",","."),this._currentDialogueEnd=r[2].replace(",","."))}else e=e.replace(/<b>/g,"{\\b1}").replace(/\{b\}/g,"{\\b1}").replace(/<\/b>/g,"{\\b0}").replace(/\{\/b\}/g,"{\\b0}").replace(/<i>/g,"{\\i1}").replace(/\{i\}/g,"{\\i1}").replace(/<\/i>/g,"{\\i0}").replace(/\{\/i\}/g,"{\\i0}").replace(/<u>/g,"{\\u1}").replace(/\{u\}/g,"{\\u1}").replace(/<\/u>/g,"{\\u0}").replace(/\{\/u\}/g,"{\\u0}").replace(/<font color="#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})">/g,(function(e,t,r,n){return"{c&H"+n+r+t+"&}"})).replace(/<\/font>/g,"{\\c}"),null!==this._currentDialogueText?this._currentDialogueText+="\\N"+e:this._currentDialogueText=e;this._stream.nextLine().then((function(e){return t._onNextLine(e)}),(function(e){t._deferred.reject(e)}))},e}();function h(e){for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r)-33;if(n<0||n>63)throw new Error("Out-of-range character code "+n+" at index "+r+" in string "+e);t+=n<26?String.fromCharCode("A".charCodeAt(0)+n):n<52?String.fromCharCode("a".charCodeAt(0)+n-26):n<62?String.fromCharCode("0".charCodeAt(0)+n-52):62===n?"+":"/"}return t}l.SrtStreamParser=c})),n("types/ass",["parser/misc","parser/stream-parsers","parser/streams","serialization","settings","utility/map","utility/promise","types/dialogue","types/misc","types/script-properties","types/style"],(function(t,r,n,i,a,s,l,u,p,c,h,f){var d=function(){function f(){if(this._properties=new c.ScriptProperties,this._styles=new s.Map,this._dialogues=[],this._attachments=[],this._stylesFormatSpecifier=null,this._dialoguesFormatSpecifier=null,1===arguments.length)throw new Error("Constructor `new ASS(rawASS)` has been deprecated. Use `ASS.fromString(rawASS)` instead.");this._styles.set("Default",new h.Style(new s.Map([["Name","Default"]])))}return f.fromString=function(e,t){return void 0===t&&(t=p.Format.ASS),f.fromStream(new n.StringStream(e),t)},f.fromStream=function(e,t){switch(void 0===t&&(t=p.Format.ASS),t){case p.Format.ASS:case"ass":return new r.StreamParser(e).ass;case p.Format.SRT:case"srt":return new r.SrtStreamParser(e).ass;default:throw new Error("Invalid value of type: "+t)}},f.fromUrl=function(t,r){var i;return void 0===r&&(r=p.Format.ASS),i="function"===typeof e.fetch&&n.BrowserReadableStream.isSupported()?e.fetch(t).then((function(e){if(!1===e.ok||void 0===e.ok&&(void 0===e.status||e.status<200||e.status>299))throw new Error("HTTP request for "+t+" failed with status code "+e.status);return f.fromReadableStream(e.body,"utf-8",r)})):l.Promise.reject(new Error("Not supported.")),i.catch((function(e){a.debugMode&&console.log("fetch() failed, falling back to XHR: %o",e);var i=new XMLHttpRequest,o=f.fromStream(new n.XhrStream(i),r);return i.open("GET",t,!0),i.send(),o}))},f.fromReadableStream=function(e,t,r){return void 0===t&&(t="utf-8"),void 0===r&&(r=p.Format.ASS),f.fromStream(new n.BrowserReadableStream(e,t),r)},f.fromJSON=function(e){var t=Object.create(f.prototype);t._properties=e._properties,t._styles=new s.Map;for(var r=0,n=Object.keys(e._styles);r<n.length;r++){var i=n[r],o=e._styles[i];t._styles.set(i,o)}return t._dialogues=e._dialogues,t._attachments=e._attachments,t._stylesFormatSpecifier=e._stylesFormatSpecifier,t._dialoguesFormatSpecifier=e._dialoguesFormatSpecifier,t},Object.defineProperty(f.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dialogues",{get:function(){return this._dialogues},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"attachments",{get:function(){return this._attachments},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"stylesFormatSpecifier",{get:function(){return this._stylesFormatSpecifier},set:function(e){this._stylesFormatSpecifier=e},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dialoguesFormatSpecifier",{get:function(){return this._dialoguesFormatSpecifier},set:function(e){this._dialoguesFormatSpecifier=e},enumerable:!0,configurable:!0}),f.prototype.addStyle=function(e){if(null===this._stylesFormatSpecifier)throw new Error("stylesFormatSpecifier is not set.");var r=t.parseLineIntoTypedTemplate(e,this._stylesFormatSpecifier);if(null!==r&&"Style"===r.type){var n=r.template;if(a.verboseMode){var i="";n.forEach((function(e,t){return i+=t+" = "+e+", "})),console.log("Read style: "+i)}var o=new h.Style(n);this._styles.set(o.name,o)}},f.prototype.addEvent=function(e){if(null===this._dialoguesFormatSpecifier)throw new Error("dialoguesFormatSpecifier is not set.");var r=t.parseLineIntoTypedTemplate(e,this._dialoguesFormatSpecifier);if(null!==r&&"Dialogue"===r.type){var n=r.template;if(a.verboseMode){var i="";n.forEach((function(e,t){return i+=t+" = "+e+", "})),console.log("Read dialogue: "+i)}this.dialogues.push(new u.Dialogue(n,this))}},f.prototype.addAttachment=function(e){this._attachments.push(e)},f.prototype.toJSON=function(){var e=Object.create(null);return e._properties=this._properties,e._styles=Object.create(null),this._styles.forEach((function(t,r){return e._styles[r]=t})),e._dialogues=this._dialogues,e._attachments=this._attachments,e._stylesFormatSpecifier=this._stylesFormatSpecifier,e._dialoguesFormatSpecifier=this._dialoguesFormatSpecifier,e._classTag=f.prototype._classTag,e},f=o([i.registerClass],f),f}();f.ASS=d})),n("types/script-properties",["serialization"],(function(e,t){var r=function(){function t(){}return Object.defineProperty(t.prototype,"resolutionX",{get:function(){return this._resolutionX},set:function(e){this._resolutionX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionY",{get:function(){return this._resolutionY},set:function(e){this._resolutionY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrappingStyle",{get:function(){return this._wrappingStyle},set:function(e){this._wrappingStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleBorderAndShadow",{get:function(){return this._scaleBorderAndShadow},set:function(e){this._scaleBorderAndShadow=e},enumerable:!0,configurable:!0}),t=o([e.registerClass],t),t}();t.ScriptProperties=r})),n("types/dialogue",["types/misc","parser/parse","parts/index","serialization","settings","utility/map"],(function(e,t,r,n,i,a,s){var l=function(){function s(t,r){this._parts=null,this._containsTransformTag=!1;var n=new a.Map;t.forEach((function(e,t){n.set(t.toLowerCase(),e)})),t=n,this._id=++s._lastDialogueId;var o=t.get("style");"string"===typeof o&&(o=o.replace(/^\*+/,""),null!==o.match(/^Default$/i)&&(o="Default"));var l=void 0!==o?r.styles.get(o):void 0;if(void 0===l&&(i.debugMode&&console.warn("Unrecognized style "+o+'. Falling back to "Default"'),l=r.styles.get("Default"),void 0===l))throw new Error("Unrecognized style "+o+'. Could not fall back to "Default" style since it doesn\'t exist.');this._style=l;var p=t.get("start");if("string"!==typeof p)throw new Error("Dialogue start time "+p+" is not a string.");this._start=u(p);var c=t.get("end");if("string"!==typeof c)throw new Error("Dialogue end time "+c+" is not a string.");this._end=u(c),this._layer=Math.max(e.valueOrDefault(t,"layer",parseInt,(function(e){return!isNaN(e)}),"0"),0);var h=t.get("text");if("string"!==typeof h)throw new Error("Dialogue text "+h+" is not a string.");this._rawPartsString=h}return Object.defineProperty(s.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"style",{get:function(){return this._style},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"alignment",{get:function(){return null===this._parts&&this._parsePartsString(),this._alignment},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"parts",{get:function(){return null===this._parts&&this._parsePartsString(),this._parts},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"containsTransformTag",{get:function(){return null===this._parts&&this._parsePartsString(),this._containsTransformTag},enumerable:!0,configurable:!0}),s.prototype.toString=function(){return"#"+this._id+" ["+this._start.toFixed(3)+"-"+this._end.toFixed(3)+"] "+(null!==this._parts?this._parts.join(", "):this._rawPartsString)},s.prototype._parsePartsString=function(){var e=this;if(this._parts=t.parse(this._rawPartsString,"dialogueParts"),this._alignment=this._style.alignment,this._parts.forEach((function(t,n){t instanceof r.Alignment?e._alignment=t.value:t instanceof r.Move?null!==t.t1&&null!==t.t2||(e._parts[n]=new r.Move(t.x1,t.y1,t.x2,t.y2,0,e._end-e._start)):t instanceof r.Transform&&(null!==t.start&&null!==t.end&&null!==t.accel||(e._parts[n]=new r.Transform(null===t.start?0:t.start,null===t.end?e._end-e._start:t.end,null===t.accel?1:t.accel,t.tags)),e._containsTransformTag=!0)})),i.debugMode){var n=this._parts.filter((function(e){return e instanceof r.Comment&&-1!==e.value.indexOf("\\")}));n.length>0&&console.warn("Possible incorrect parse:\n"+this._rawPartsString+"\nwas parsed as\n"+this.toString()+"\nThe possibly incorrect parses are:\n"+n.join("\n"))}},s._lastDialogueId=-1,s=o([n.registerClass],s),s}();function u(e){return e.split(":").reduce((function(e,t){return 60*e+parseFloat(t)}),0)}s.Dialogue=l})),n("types/style",["parser/parse","serialization","utility/map","types/misc"],(function(e,t,r,n,i){var a=function(){function i(t){var i=new r.Map;t.forEach((function(e,t){i.set(t.toLowerCase(),e)})),t=i;var o=t.get("name");if("string"!==typeof o)throw new Error("Style name "+o+" is not a string.");this._name=o.replace(/^\*+/,""),this._italic=!!n.valueOrDefault(t,"italic",parseFloat,(function(e){return!isNaN(e)}),"0"),this._bold=!!n.valueOrDefault(t,"bold",parseFloat,(function(e){return!isNaN(e)}),"0"),this._underline=!!n.valueOrDefault(t,"underline",parseFloat,(function(e){return!isNaN(e)}),"0"),this._strikeThrough=!!n.valueOrDefault(t,"strikeout",parseFloat,(function(e){return!isNaN(e)}),"0"),this._fontName=n.valueOrDefault(t,"fontname",(function(e){return e}),(function(e){return e.constructor===String}),"sans-serif"),this._fontSize=n.valueOrDefault(t,"fontsize",parseFloat,(function(e){return!isNaN(e)}),"18"),this._fontScaleX=n.valueOrDefault(t,"scalex",parseFloat,(function(e){return e>=0}),"100")/100,this._fontScaleY=n.valueOrDefault(t,"scaley",parseFloat,(function(e){return e>=0}),"100")/100,this._letterSpacing=n.valueOrDefault(t,"spacing",parseFloat,(function(e){return e>=0}),"0"),this._rotationZ=n.valueOrDefault(t,"angle",parseFloat,(function(e){return!isNaN(e)}),"0"),this._primaryColor=n.valueOrDefault(t,"primarycolour",(function(t){return e.parse(t,"colorWithAlpha")}),null,"&H00FFFFFF"),this._secondaryColor=n.valueOrDefault(t,"secondarycolour",(function(t){return e.parse(t,"colorWithAlpha")}),null,"&H00FFFF00"),this._outlineColor=n.valueOrDefault(t,"outlinecolour",(function(t){return e.parse(t,"colorWithAlpha")}),null,"&H00000000"),this._shadowColor=n.valueOrDefault(t,"backcolour",(function(t){return e.parse(t,"colorWithAlpha")}),null,"&H80000000"),this._outlineThickness=n.valueOrDefault(t,"outline",parseFloat,(function(e){return e>=0}),"2"),this._borderStyle=n.valueOrDefault(t,"borderstyle",parseInt,(function(e){return n.BorderStyle[n.BorderStyle[e]]===e}),"1"),this._shadowDepth=n.valueOrDefault(t,"shadow",parseFloat,(function(e){return e>=0}),"3"),this._alignment=n.valueOrDefault(t,"alignment",parseInt,(function(e){return e>=1&&e<=9}),"2"),this._marginLeft=n.valueOrDefault(t,"marginl",parseFloat,(function(e){return!isNaN(e)}),"20"),this._marginRight=n.valueOrDefault(t,"marginr",parseFloat,(function(e){return!isNaN(e)}),"20"),this._marginVertical=n.valueOrDefault(t,"marginv",parseFloat,(function(e){return!isNaN(e)}),"20")}return Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"italic",{get:function(){return this._italic},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bold",{get:function(){return this._bold},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"underline",{get:function(){return this._underline},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"strikeThrough",{get:function(){return this._strikeThrough},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontName",{get:function(){return this._fontName},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontScaleX",{get:function(){return this._fontScaleX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontScaleY",{get:function(){return this._fontScaleY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"letterSpacing",{get:function(){return this._letterSpacing},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._rotationZ},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{get:function(){return this._primaryColor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{get:function(){return this._secondaryColor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outlineColor",{get:function(){return this._outlineColor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowColor",{get:function(){return this._shadowColor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outlineThickness",{get:function(){return this._outlineThickness},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"borderStyle",{get:function(){return this._borderStyle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowDepth",{get:function(){return this._shadowDepth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alignment",{get:function(){return this._alignment},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"marginLeft",{get:function(){return this._marginLeft},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"marginRight",{get:function(){return this._marginRight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"marginVertical",{get:function(){return this._marginVertical},enumerable:!0,configurable:!0}),i=o([t.registerClass],i),i}();i.Style=a})),n("types/attachment",["serialization"],(function(e,t){(function(e){e[e["Font"]=0]="Font",e[e["Graphic"]=1]="Graphic"})(t.AttachmentType||(t.AttachmentType={}));var r=function(){function t(e,t){this._filename=e,this._type=t,this._contents=""}return Object.defineProperty(t.prototype,"filename",{get:function(){return this._filename},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contents",{get:function(){return this._contents},set:function(e){this._contents=e},enumerable:!0,configurable:!0}),t=o([e.registerClass],t),t}();t.Attachment=r})),n("parser/misc",["utility/map"],(function(e,t){function r(e){var t=e.indexOf(":");if(-1===t)return null;var r=e.substr(0,t),n=e.substr(t+1).replace(/^\s+/,"");return{name:r,value:n}}function n(t,n){var i=r(t);if(null===i)return null;var o=i.value.split(",");o.length>n.length&&(o[n.length-1]=o.slice(n.length-1).join(","));var a=new e.Map;return n.forEach((function(e,t){a.set(e,o[t])})),{type:i.name,template:a}}t.parseLineIntoProperty=r,t.parseLineIntoTypedTemplate=n})),n("parser/streams",["utility/promise"],(function(t,r){var n=function(){function e(e){this._str=e,this._readTill=0}return e.prototype.nextLine=function(){var e;if(this._readTill<this._str.length){var r=this._str.indexOf("\n",this._readTill);-1!==r?(e=t.Promise.resolve(this._str.substring(this._readTill,r)),this._readTill=r+1):(e=t.Promise.resolve(this._str.substr(this._readTill)),this._readTill=this._str.length)}else e=t.Promise.resolve(null);return e},e}();r.StringStream=n;var i=function(){function e(e){var t=this;this._xhr=e,this._readTill=0,this._pendingDeferred=null,this._failedError=null,e.addEventListener("progress",(function(){return t._onXhrProgress()}),!1),e.addEventListener("load",(function(){return t._onXhrLoad()}),!1),e.addEventListener("error",(function(e){return t._onXhrError(e)}),!1)}return e.prototype.nextLine=function(){if(null!==this._pendingDeferred)throw new Error("XhrStream only supports one pending unfulfilled read at a time.");var e=this._pendingDeferred=new t.DeferredPromise;return this._tryResolveNextLine(),e.promise},e.prototype._onXhrProgress=function(){null!==this._pendingDeferred&&this._xhr.readyState!==XMLHttpRequest.DONE&&this._tryResolveNextLine()},e.prototype._onXhrLoad=function(){null!==this._pendingDeferred&&this._tryResolveNextLine()},e.prototype._onXhrError=function(e){this._failedError=e,null!==this._pendingDeferred&&this._tryResolveNextLine()},e.prototype._tryResolveNextLine=function(){if(null===this._failedError){var e=this._xhr.responseText,t=e.indexOf("\n",this._readTill);-1!==t?(this._pendingDeferred.resolve(e.substring(this._readTill,t)),this._readTill=t+1,this._pendingDeferred=null):this._xhr.readyState===XMLHttpRequest.DONE&&(this._readTill<e.length?(this._pendingDeferred.resolve(e.substr(this._readTill)),this._readTill=e.length):this._pendingDeferred.resolve(null),this._pendingDeferred=null)}else this._pendingDeferred.reject(this._failedError)},e}();r.XhrStream=i;var o=function(){function r(t,r){this._buffer="",this._pendingDeferred=null,this._reader=t.getReader(),this._decoder=new e.TextDecoder(r,{ignoreBOM:!0})}return r.isSupported=function(){return void 0!==e.ReadableStream&&"function"===typeof e.ReadableStream.prototype.getReader&&"function"===typeof e.TextDecoder},r.prototype.nextLine=function(){if(null!==this._pendingDeferred)throw new Error("BrowserReadableStream only supports one pending unfulfilled read at a time.");var e=this._pendingDeferred=new t.DeferredPromise;return this._tryResolveNextLine(),e.promise},r.prototype._tryResolveNextLine=function(){var e=this,t=this._buffer.indexOf("\n");-1!==t?(this._pendingDeferred.resolve(this._buffer.substr(0,t)),this._buffer=this._buffer.substr(t+1),this._pendingDeferred=null):this._reader.read().then((function(t){var r=t.value,n=t.done;n?(0===e._buffer.length?e._pendingDeferred.resolve(null):(e._pendingDeferred.resolve(e._buffer),e._buffer=""),e._pendingDeferred=null):(e._buffer+=e._decoder.decode(r,{stream:!0}),e._tryResolveNextLine())}))},r}();r.BrowserReadableStream=o})),n("parser/parse",["parts/index","settings","utility/map","utility/promise","webworker/commands","webworker/misc"],(function(e,t,r,n,i,o,a){var s=new r.Map;function l(e,r){var n=new p(e,r).result;if(null===n||n.end!==e.length)throw t.debugMode&&console.error("Parse failed. %s %s %o",r,e,n),new Error("Parse failed.");return n.value}a.parse=l;var u=function(){function e(e,t){void 0===t&&(t=null),this._parent=e,this._children=[],null!==e&&e.children.push(this),this._start=null!==e?e.end:0,this._end=this._start,this.value=t}return Object.defineProperty(e.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,null!==this._value&&this._value.constructor===String&&0===this._children.length&&this._setEnd(this._start+this._value.length)},enumerable:!0,configurable:!0}),e.prototype.pop=function(){this._children.splice(this._children.length-1,1),this._children.length>0?this._setEnd(this._children[this._children.length-1].end):this._setEnd(this.start)},e.prototype._setEnd=function(e){this._end=e,null!==this._parent&&this._parent.end!==this._end&&this._parent._setEnd(this._end)},e}(),p=function(){function t(e,t){this._input=e;var r=s.get(t);if(void 0===r)throw new Error("Could not find parser rule named "+t);this._parseTree=new u(null),this._result=r.call(this,this._parseTree)}return Object.defineProperty(t.prototype,"result",{get:function(){return this._result},enumerable:!0,configurable:!0}),t.prototype.parse_dialogueParts=function(t){var r,n=new u(t);n.value=[];while(this._haveMore()){var i=this.parse_enclosedTags(n);if(null!==i)(r=n.value).push.apply(r,i.value);else{var o=this.parse_newline(n)||this.parse_soft_newline(n)||this.parse_hardspace(n)||this.parse_text(n);if(o.value instanceof e.Text&&n.value[n.value.length-1]instanceof e.Text){var a=n.value[n.value.length-1];n.value[n.value.length-1]=new e.Text(a.value+o.value.value)}else n.value.push(o.value)}}var s=!1;return n.value.forEach((function(t,r){t instanceof e.DrawingMode?s=0!==t.scale:t instanceof e.Text&&s&&(n.value[r]=new e.DrawingInstructions(l(t.value,"drawingInstructions")))})),n},t.prototype.parse_enclosedTags=function(t){var r=new u(t);if(r.value=[],null===this.read(r,"{"))return t.pop(),null;for(var n=this._peek();this._haveMore()&&"}"!==n;n=this._peek()){var i=null;null!==this.read(r,"\\")&&(i=this.parse_tag_alpha(r)||this.parse_tag_iclip(r)||this.parse_tag_xbord(r)||this.parse_tag_ybord(r)||this.parse_tag_xshad(r)||this.parse_tag_yshad(r)||this.parse_tag_blur(r)||this.parse_tag_bord(r)||this.parse_tag_clip(r)||this.parse_tag_fade(r)||this.parse_tag_fscx(r)||this.parse_tag_fscy(r)||this.parse_tag_move(r)||this.parse_tag_shad(r)||this.parse_tag_fad(r)||this.parse_tag_fax(r)||this.parse_tag_fay(r)||this.parse_tag_frx(r)||this.parse_tag_fry(r)||this.parse_tag_frz(r)||this.parse_tag_fsp(r)||this.parse_tag_fsplus(r)||this.parse_tag_fsminus(r)||this.parse_tag_org(r)||this.parse_tag_pbo(r)||this.parse_tag_pos(r)||this.parse_tag_an(r)||this.parse_tag_be(r)||this.parse_tag_fn(r)||this.parse_tag_fr(r)||this.parse_tag_fs(r)||this.parse_tag_kf(r)||this.parse_tag_ko(r)||this.parse_tag_1a(r)||this.parse_tag_1c(r)||this.parse_tag_2a(r)||this.parse_tag_2c(r)||this.parse_tag_3a(r)||this.parse_tag_3c(r)||this.parse_tag_4a(r)||this.parse_tag_4c(r)||this.parse_tag_a(r)||this.parse_tag_b(r)||this.parse_tag_c(r)||this.parse_tag_i(r)||this.parse_tag_k(r)||this.parse_tag_K(r)||this.parse_tag_p(r)||this.parse_tag_q(r)||this.parse_tag_r(r)||this.parse_tag_s(r)||this.parse_tag_t(r)||this.parse_tag_u(r),null===i&&r.pop()),null===i&&(i=this.parse_comment(r)),i.value instanceof e.Comment&&r.value[r.value.length-1]instanceof e.Comment?r.value[r.value.length-1]=new e.Comment(r.value[r.value.length-1].value+i.value.value):r.value.push(i.value)}return null===this.read(r,"}")?(t.pop(),null):r},t.prototype.parse_newline=function(t){var r=new u(t);return null===this.read(r,"\\N")?(t.pop(),null):(r.value=new e.NewLine,r)},t.prototype.parse_soft_newline=function(t){var r=new u(t);return null===this.read(r,"\\n")?(t.pop(),null):(r.value=new e.SoftNewLine,r)},t.prototype.parse_hardspace=function(t){var r=new u(t);return null===this.read(r,"\\h")?(t.pop(),null):(r.value=new e.Text(" "),r)},t.prototype.parse_text=function(t){var r=this._peek(),n=new u(t),i=new u(n,r);return n.value=new e.Text(i.value),n},t.prototype.parse_comment=function(t){var r=this._peek(),n=new u(t),i=new u(n,r);return n.value=new e.Comment(i.value),n},t.prototype.parse_tag_a=function(t){var r=new u(t);if(null===this.read(r,"a"))return t.pop(),null;var n=this._peek();switch(n){case"1":var i=this._peek(2);switch(i){case"10":case"11":n=i;break}break;case"2":case"3":case"5":case"6":case"7":case"9":break;default:return t.pop(),null}var o=new u(r,n),a=-1;switch(o.value){case"1":a=1;break;case"2":a=2;break;case"3":a=3;break;case"5":a=7;break;case"6":a=8;break;case"7":a=9;break;case"9":a=4;break;case"10":a=5;break;case"11":a=6;break}return r.value=new e.Alignment(a),r},t.prototype.parse_tag_alpha=function(){throw new Error("unreachable")},t.prototype.parse_tag_an=function(t){var r=new u(t);if(null===this.read(r,"an"))return t.pop(),null;var n=this._peek();if(n<"1"||n>"9")return t.pop(),null;var i=new u(r,n);return r.value=new e.Alignment(parseInt(i.value)),r},t.prototype.parse_tag_b=function(t){var r=new u(t);if(null===this.read(r,"b"))return t.pop(),null;var n=null,i=this._peek();return i>="1"&&i<="9"&&(i=this._peek(3),"00"===i.substr(1)&&(n=new u(r,i),n.value=parseInt(n.value))),null===n&&(n=this.parse_enableDisable(r)),r.value=null!==n?new e.Bold(n.value):new e.Bold(null),r},t.prototype.parse_tag_be=function(){throw new Error("unreachable")},t.prototype.parse_tag_blur=function(){throw new Error("unreachable")},t.prototype.parse_tag_bord=function(){throw new Error("unreachable")},t.prototype.parse_tag_c=function(){throw new Error("unreachable")},t.prototype.parse_tag_clip=function(e){return this._parse_tag_clip_or_iclip("clip",e)},t.prototype.parse_tag_fad=function(t){var r=new u(t);if(null===this.read(r,"fad"))return t.pop(),null;if(null===this.read(r,"("))return t.pop(),null;var n=this.parse_decimal(r);if(null===n)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var i=this.parse_decimal(r);return null===i||null===this.read(r,")")?(t.pop(),null):(r.value=new e.Fade(n.value/1e3,i.value/1e3),r)},t.prototype.parse_tag_fade=function(t){var r=new u(t);if(null===this.read(r,"fade"))return t.pop(),null;if(null===this.read(r,"("))return t.pop(),null;var n=this.parse_decimal(r);if(null===n)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var i=this.parse_decimal(r);if(null===i)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var o=this.parse_decimal(r);if(null===o)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var a=this.parse_decimal(r);if(null===a)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var s=this.parse_decimal(r);if(null===s)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var l=this.parse_decimal(r);if(null===l)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var p=this.parse_decimal(r);return null===p||null===this.read(r,")")?(t.pop(),null):(r.value=new e.ComplexFade(1-n.value/255,1-i.value/255,1-o.value/255,a.value/1e3,s.value/1e3,l.value/1e3,p.value/1e3),r)},t.prototype.parse_tag_fax=function(){throw new Error("unreachable")},t.prototype.parse_tag_fay=function(){throw new Error("unreachable")},t.prototype.parse_tag_fn=function(t){var r=new u(t);if(null===this.read(r,"fn"))return t.pop(),null;for(var n=new u(r,""),i=this._peek();this._haveMore()&&"\\"!==i&&"}"!==i;i=this._peek())n.value+=i;return n.value.length>0?r.value=new e.FontName(n.value):r.value=new e.FontName(null),r},t.prototype.parse_tag_fr=function(){throw new Error("unreachable")},t.prototype.parse_tag_frx=function(){throw new Error("unreachable")},t.prototype.parse_tag_fry=function(){throw new Error("unreachable")},t.prototype.parse_tag_frz=function(){throw new Error("unreachable")},t.prototype.parse_tag_fs=function(){throw new Error("unreachable")},t.prototype.parse_tag_fsplus=function(t){var r=new u(t);if(null===this.read(r,"fs+"))return t.pop(),null;var n=this.parse_decimal(r);return null===n?(t.pop(),null):(r.value=new e.FontSizePlus(n.value/10),r)},t.prototype.parse_tag_fsminus=function(t){var r=new u(t);if(null===this.read(r,"fs-"))return t.pop(),null;var n=this.parse_decimal(r);return null===n?(t.pop(),null):(r.value=new e.FontSizeMinus(n.value/10),r)},t.prototype.parse_tag_fscx=function(t){var r=new u(t);if(null===this.read(r,"fscx"))return t.pop(),null;var n=this.parse_decimal(r);return r.value=null!==n?new e.FontScaleX(n.value/100):new e.FontScaleX(null),r},t.prototype.parse_tag_fscy=function(t){var r=new u(t);if(null===this.read(r,"fscy"))return t.pop(),null;var n=this.parse_decimal(r);return r.value=null!==n?new e.FontScaleY(n.value/100):new e.FontScaleY(null),r},t.prototype.parse_tag_fsp=function(){throw new Error("unreachable")},t.prototype.parse_tag_i=function(){throw new Error("unreachable")},t.prototype.parse_tag_iclip=function(e){return this._parse_tag_clip_or_iclip("iclip",e)},t.prototype.parse_tag_k=function(t){var r=new u(t);if(null===this.read(r,"k"))return t.pop(),null;var n=this.parse_decimal(r);return null===n?(t.pop(),null):(r.value=new e.ColorKaraoke(n.value/100),r)},t.prototype.parse_tag_K=function(t){var r=new u(t);if(null===this.read(r,"K"))return t.pop(),null;var n=this.parse_decimal(r);return null===n?(t.pop(),null):(r.value=new e.SweepingColorKaraoke(n.value/100),r)},t.prototype.parse_tag_kf=function(t){var r=new u(t);if(null===this.read(r,"kf"))return t.pop(),null;var n=this.parse_decimal(r);return null===n?(t.pop(),null):(r.value=new e.SweepingColorKaraoke(n.value/100),r)},t.prototype.parse_tag_ko=function(t){var r=new u(t);if(null===this.read(r,"ko"))return t.pop(),null;var n=this.parse_decimal(r);return null===n?(t.pop(),null):(r.value=new e.OutlineKaraoke(n.value/100),r)},t.prototype.parse_tag_move=function(t){var r=new u(t);if(null===this.read(r,"move"))return t.pop(),null;if(null===this.read(r,"("))return t.pop(),null;var n=this.parse_decimal(r);if(null===n)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var i=this.parse_decimal(r);if(null===i)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var o=this.parse_decimal(r);if(null===o)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var a=this.parse_decimal(r);if(null===a)return t.pop(),null;var s=null,l=null;if(null!==this.read(r,",")){if(s=this.parse_decimal(r),null===s)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;if(l=this.parse_decimal(r),null===l)return t.pop(),null}return null===this.read(r,")")?(t.pop(),null):(r.value=new e.Move(n.value,i.value,o.value,a.value,null!==s?s.value/1e3:null,null!==l?l.value/1e3:null),r)},t.prototype.parse_tag_org=function(t){var r=new u(t);if(null===this.read(r,"org"))return t.pop(),null;if(null===this.read(r,"("))return t.pop(),null;var n=this.parse_decimal(r);if(null===n)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var i=this.parse_decimal(r);return null===i||null===this.read(r,")")?(t.pop(),null):(r.value=new e.RotationOrigin(n.value,i.value),r)},t.prototype.parse_tag_p=function(){throw new Error("unreachable")},t.prototype.parse_tag_pbo=function(){throw new Error("unreachable")},t.prototype.parse_tag_pos=function(t){var r=new u(t);if(null===this.read(r,"pos"))return t.pop(),null;if(null===this.read(r,"("))return t.pop(),null;var n=this.parse_decimal(r);if(null===n)return t.pop(),null;if(null===this.read(r,","))return t.pop(),null;var i=this.parse_decimal(r);return null===i||null===this.read(r,")")?(t.pop(),null):(r.value=new e.Position(n.value,i.value),r)},t.prototype.parse_tag_q=function(t){var r=new u(t);if(null===this.read(r,"q"))return t.pop(),null;var n=this._peek();if(n<"0"||n>"3")return t.pop(),null;var i=new u(r,n);return r.value=new e.WrappingStyle(parseInt(i.value)),r},t.prototype.parse_tag_r=function(t){var r=new u(t);if(null===this.read(r,"r"))return t.pop(),null;for(var n=new u(r,""),i=this._peek();this._haveMore()&&"\\"!==i&&"}"!==i;i=this._peek())n.value+=i;return n.value.length>0?r.value=new e.Reset(n.value):r.value=new e.Reset(null),r},t.prototype.parse_tag_s=function(){throw new Error("unreachable")},t.prototype.parse_tag_shad=function(){throw new Error("unreachable")},t.prototype.parse_tag_t=function(t){var r=new u(t);if(null===this.read(r,"t"))return t.pop(),null;if(null===this.read(r,"("))return t.pop(),null;var n=null,i=null,o=null,a=this.parse_decimal(r);if(null!==a){if(null===this.read(r,","))return t.pop(),null;var s=this.parse_decimal(r);if(null!==s){if(n=a,i=s,null===this.read(r,","))return t.pop(),null;var l=this.parse_decimal(r);if(null!==l&&(o=l,null===this.read(r,",")))return t.pop(),null}else if(o=a,null===this.read(r,","))return t.pop(),null}for(var p=[],c=this._peek();this._haveMore()&&")"!==c&&"}"!==c;c=this._peek()){var h=null;null!==this.read(r,"\\")&&(h=this.parse_tag_alpha(r)||this.parse_tag_iclip(r)||this.parse_tag_xbord(r)||this.parse_tag_ybord(r)||this.parse_tag_xshad(r)||this.parse_tag_yshad(r)||this.parse_tag_blur(r)||this.parse_tag_bord(r)||this.parse_tag_clip(r)||this.parse_tag_fscx(r)||this.parse_tag_fscy(r)||this.parse_tag_shad(r)||this.parse_tag_fax(r)||this.parse_tag_fay(r)||this.parse_tag_frx(r)||this.parse_tag_fry(r)||this.parse_tag_frz(r)||this.parse_tag_fsp(r)||this.parse_tag_fsplus(r)||this.parse_tag_fsminus(r)||this.parse_tag_be(r)||this.parse_tag_fr(r)||this.parse_tag_fs(r)||this.parse_tag_1a(r)||this.parse_tag_1c(r)||this.parse_tag_2a(r)||this.parse_tag_2c(r)||this.parse_tag_3a(r)||this.parse_tag_3c(r)||this.parse_tag_4a(r)||this.parse_tag_4c(r)||this.parse_tag_c(r),null===h&&r.pop()),null===h&&(h=this.parse_comment(r)),h.value instanceof e.Comment&&p[p.length-1]instanceof e.Comment?p[p.length-1]=new e.Comment(p[p.length-1].value+h.value.value):p.push(h.value)}return this.read(r,")"),r.value=new e.Transform(null!==n?n.value/1e3:null,null!==i?i.value/1e3:null,null!==o?o.value/1e3:null,p),r},t.prototype.parse_tag_u=function(){throw new Error("unreachable")},t.prototype.parse_tag_xbord=function(){throw new Error("unreachable")},t.prototype.parse_tag_xshad=function(){throw new Error("unreachable")},t.prototype.parse_tag_ybord=function(){throw new Error("unreachable")},t.prototype.parse_tag_yshad=function(){throw new Error("unreachable")},t.prototype.parse_tag_1a=function(){throw new Error("unreachable")},t.prototype.parse_tag_1c=function(){throw new Error("unreachable")},t.prototype.parse_tag_2a=function(){throw new Error("unreachable")},t.prototype.parse_tag_2c=function(){throw new Error("unreachable")},t.prototype.parse_tag_3a=function(){throw new Error("unreachable")},t.prototype.parse_tag_3c=function(){throw new Error("unreachable")},t.prototype.parse_tag_4a=function(){throw new Error("unreachable")},t.prototype.parse_tag_4c=function(){throw new Error("unreachable")},t.prototype.parse_drawingInstructions=function(t){var r=new u(t),n=null,i=[];r.value=[];while(this._haveMore()){while(null!==this.read(r," "));if(!this._haveMore())break;if(null!==n){var o=this.parse_decimal(r);if(null!==o){i.push(o),"m"===n&&2===i.length?(r.value.push(new e.drawing.MoveInstruction(i[0].value,i[1].value)),i.splice(0,i.length)):"l"===n&&2===i.length?(r.value.push(new e.drawing.LineInstruction(i[0].value,i[1].value)),i.splice(0,i.length)):"b"===n&&6===i.length&&(r.value.push(new e.drawing.CubicBezierCurveInstruction(i[0].value,i[1].value,i[2].value,i[3].value,i[4].value,i[5].value)),i.splice(0,i.length));continue}}var a=this.parse_text(r),s=a.value.value;switch(s){case"m":case"l":case"b":n=s,i.splice(0,i.length);break}}while(null!==this.read(r," "));return r},t.prototype.parse_decimalInt32=function(e){for(var t=new u(e),r=null!==this.read(t,"-"),n=new u(t,""),i=this._peek();this._haveMore()&&i>="0"&&i<="9";i=this._peek())n.value+=i;if(0===n.value.length)return e.pop(),null;var o=parseInt(n.value);return o>=4294967295?o=4294967295:r&&(o=-o),t.value=o,t},t.prototype.parse_hexInt32=function(e){for(var t=new u(e),r=null!==this.read(t,"-"),n=new u(t,""),i=this._peek();this._haveMore()&&(i>="0"&&i<="9"||i>="a"&&i<="f"||i>="A"&&i<="F");i=this._peek())n.value+=i;if(0===n.value.length)return e.pop(),null;var o=parseInt(n.value,16);return o>=4294967295?o=4294967295:r&&(o=-o),t.value=o,t},t.prototype.parse_decimalOrHexInt32=function(e){var t=new u(e),r=null!==this.read(t,"&H")||null!==this.read(t,"&h")?this.parse_hexInt32(t):this.parse_decimalInt32(t);return null===r?(e.pop(),null):(t.value=r.value,t)},t.prototype.parse_decimal=function(e){var t=new u(e),r=null!==this.read(t,"-"),n=this.parse_unsignedDecimal(t);return null===n?(e.pop(),null):(t.value=n.value,r&&(t.value=-t.value),t)},t.prototype.parse_unsignedDecimal=function(e){for(var t=new u(e),r=new u(t,""),n=null,i=this._peek();this._haveMore()&&i>="0"&&i<="9";i=this._peek())r.value+=i;if(0===r.value.length)return e.pop(),null;if(null!==this.read(t,".")){n=new u(t,"");for(i=this._peek();this._haveMore()&&i>="0"&&i<="9";i=this._peek())n.value+=i;if(0===n.value.length)return e.pop(),null}return t.value=parseFloat(r.value+(null!==n?"."+n.value:"")),t},t.prototype.parse_enableDisable=function(e){var t=this._peek();if("0"===t||"1"===t){var r=new u(e,t);return r.value="1"===r.value,r}return null},t.prototype.parse_color=function(t){var r=new u(t);while(null!==this.read(r,"&")||null!==this.read(r,"H"));var n=this.parse_hexInt32(r);if(null===n)return t.pop(),null;var i=n.value;r.value=new e.Color(255&i,i>>8&255,i>>16&255);while(null!==this.read(r,"&")||null!==this.read(r,"H"));return r},t.prototype.parse_alpha=function(e){var t=new u(e);while(null!==this.read(t,"&")||null!==this.read(t,"H"));var r=this.parse_hexInt32(t);if(null===r)return e.pop(),null;var n=r.value;t.value=1-(255&n)/255;while(null!==this.read(t,"&")||null!==this.read(t,"H"));return t},t.prototype.parse_colorWithAlpha=function(t){var r=new u(t),n=this.parse_decimalOrHexInt32(r);if(null===n)return t.pop(),null;var i=n.value;return r.value=new e.Color(255&i,i>>8&255,i>>16&255,1-(i>>24&255)/255),r},t.prototype.read=function(e,t){return this._peek(t.length)!==t?null:new u(e,t)},t.prototype._peek=function(e){return void 0===e&&(e=1),1===e?this._input[this._parseTree.end]:this._input.substr(this._parseTree.end,e)},t.prototype._haveMore=function(){return this._parseTree.end<this._input.length},t.prototype._parse_tag_clip_or_iclip=function(t,r){var n=new u(r);if(null===this.read(n,t))return r.pop(),null;if(null===this.read(n,"("))return r.pop(),null;var i=null,o=null,a=null,s=null,p=null,c=null,h=this.parse_decimal(n);if(null!==h){if(null===this.read(n,","))return r.pop(),null;var f=this.parse_decimal(n);null!==f?(i=h,a=f):p=h}if(null!==i&&null!==a){if(null===this.read(n,","))return r.pop(),null;if(o=this.parse_decimal(n),null===o)return r.pop(),null;if(null===this.read(n,","))return r.pop(),null;if(s=this.parse_decimal(n),null===s)return r.pop(),null;n.value=new e.RectangularClip(i.value,a.value,o.value,s.value,"clip"===t)}else{c=new u(n,"");for(var d=this._peek();this._haveMore()&&")"!==d&&"}"!==d;d=this._peek())c.value+=d;n.value=new e.VectorClip(null!==p?p.value:1,l(c.value,"drawingInstructions"),"clip"===t)}return null===this.read(n,")")?(r.pop(),null):n},t}();function c(e,t,r,n){p.prototype["parse_tag_"+e]=function(i){var o=new u(i);if(null===this.read(o,e))return i.pop(),null;var a=r.call(this,o);if(null!==a)o.value=new t(a.value);else{if(n)return i.pop(),null;o.value=new t(null)}return o}}c("alpha",e.Alpha,p.prototype.parse_alpha,!1),c("be",e.Blur,p.prototype.parse_decimal,!1),c("blur",e.GaussianBlur,p.prototype.parse_decimal,!1),c("bord",e.Border,p.prototype.parse_decimal,!1),c("c",e.PrimaryColor,p.prototype.parse_color,!1),c("fax",e.SkewX,p.prototype.parse_decimal,!1),c("fay",e.SkewY,p.prototype.parse_decimal,!1),c("fr",e.RotateZ,p.prototype.parse_decimal,!1),c("frx",e.RotateX,p.prototype.parse_decimal,!1),c("fry",e.RotateY,p.prototype.parse_decimal,!1),c("frz",e.RotateZ,p.prototype.parse_decimal,!1),c("fs",e.FontSize,p.prototype.parse_decimal,!1),c("fsp",e.LetterSpacing,p.prototype.parse_decimal,!1),c("i",e.Italic,p.prototype.parse_enableDisable,!1),c("p",e.DrawingMode,p.prototype.parse_decimal,!0),c("pbo",e.DrawingBaselineOffset,p.prototype.parse_decimal,!0),c("s",e.StrikeThrough,p.prototype.parse_enableDisable,!1),c("shad",e.Shadow,p.prototype.parse_decimal,!1),c("u",e.Underline,p.prototype.parse_enableDisable,!1),c("xbord",e.BorderX,p.prototype.parse_decimal,!1),c("xshad",e.ShadowX,p.prototype.parse_decimal,!1),c("ybord",e.BorderY,p.prototype.parse_decimal,!1),c("yshad",e.ShadowY,p.prototype.parse_decimal,!1),c("1a",e.PrimaryAlpha,p.prototype.parse_alpha,!1),c("1c",e.PrimaryColor,p.prototype.parse_color,!1),c("2a",e.SecondaryAlpha,p.prototype.parse_alpha,!1),c("2c",e.SecondaryColor,p.prototype.parse_color,!1),c("3a",e.OutlineAlpha,p.prototype.parse_alpha,!1),c("3c",e.OutlineColor,p.prototype.parse_color,!1),c("4a",e.ShadowAlpha,p.prototype.parse_alpha,!1),c("4c",e.ShadowColor,p.prototype.parse_color,!1);for(var h=0,f=Object.keys(p.prototype);h<f.length;h++){var d=f[h];0===d.indexOf("parse_")&&"function"===typeof p.prototype[d]&&s.set(d.substr("parse_".length),p.prototype[d])}o.registerWorkerCommand(i.WorkerCommands.Parse,(function(e){return new n.Promise((function(t){t(l(e.input,e.rule))}))}))})),n("parts/index",["parts/drawing","serialization"],(function(e,t,r){r.drawing=e;var n=function(){function e(e,t,r,n){void 0===n&&(n=1),this._red=e,this._green=t,this._blue=r,this._alpha=n}return Object.defineProperty(e.prototype,"red",{get:function(){return this._red},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"green",{get:function(){return this._green},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blue",{get:function(){return this._blue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},enumerable:!0,configurable:!0}),e.prototype.withAlpha=function(t){return new e(this._red,this._green,this._blue,t)},e.prototype.toString=function(){return"rgba("+this._red+", "+this._green+", "+this._blue+", "+this._alpha.toFixed(3)+")"},e.prototype.interpolate=function(t,r){return new e(this._red+r*(t.red-this._red),this._green+r*(t.green-this._green),this._blue+r*(t.blue-this._blue),this._alpha+r*(t.alpha-this._alpha))},e}();r.Color=n;var i=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Comment=i;var o=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Text { value: "+this._value.replace(/\u00A0/g,"\\h")+" }"},e}();r.Text=o;var a=function(){function e(){}return e}();r.NewLine=a;var s=function(){function e(){}return e}();r.SoftNewLine=s;var l=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Italic=l;var u=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Bold=u;var p=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Underline=p;var c=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.StrikeThrough=c;var h=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Border=h;var f=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.BorderX=f;var d=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.BorderY=d;var _=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Shadow=_;var g=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.ShadowX=g;var y=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.ShadowY=y;var v=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Blur=v;var b=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.GaussianBlur=b;var m=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.FontName=m;var w=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.FontSize=w;var S=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.FontSizePlus=S;var k=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.FontSizeMinus=k;var O=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.FontScaleX=O;var C=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.FontScaleY=C;var x=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.LetterSpacing=x;var P=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.RotateX=P;var E=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.RotateY=E;var j=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.RotateZ=j;var A=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.SkewX=A;var F=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.SkewY=F;var T=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.PrimaryColor=T;var M=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.SecondaryColor=M;var D=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.OutlineColor=D;var N=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.ShadowColor=N;var R=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Alpha=R;var W=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.PrimaryAlpha=W;var X=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.SecondaryAlpha=X;var V=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.OutlineAlpha=V;var L=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.ShadowAlpha=L;var Y=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Alignment=Y;var I=function(){function e(e){this._duration=e}return Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e}();r.ColorKaraoke=I;var z=function(){function e(e){this._duration=e}return Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e}();r.SweepingColorKaraoke=z;var B=function(){function e(e){this._duration=e}return Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e}();r.OutlineKaraoke=B;var G=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.WrappingStyle=G;var U=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.Reset=U;var q=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();r.Position=q;var H=function(){function e(e,t,r,n,i,o){this._x1=e,this._y1=t,this._x2=r,this._y2=n,this._t1=i,this._t2=o}return Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t1",{get:function(){return this._t1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t2",{get:function(){return this._t2},enumerable:!0,configurable:!0}),e}();r.Move=H;var K=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();r.RotationOrigin=K;var Z=function(){function e(e,t){this._start=e,this._end=t}return Object.defineProperty(e.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),e}();r.Fade=Z;var J=function(){function e(e,t,r,n,i,o,a){this._a1=e,this._a2=t,this._a3=r,this._t1=n,this._t2=i,this._t3=o,this._t4=a}return Object.defineProperty(e.prototype,"a1",{get:function(){return this._a1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a2",{get:function(){return this._a2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a3",{get:function(){return this._a3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t1",{get:function(){return this._t1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t2",{get:function(){return this._t2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t3",{get:function(){return this._t3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t4",{get:function(){return this._t4},enumerable:!0,configurable:!0}),e}();r.ComplexFade=J;var $=function(){function e(e,t,r,n){this._start=e,this._end=t,this._accel=r,this._tags=n}return Object.defineProperty(e.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accel",{get:function(){return this._accel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tags",{get:function(){return this._tags},enumerable:!0,configurable:!0}),e}();r.Transform=$;var Q=function(){function e(e,t,r,n,i){this._x1=e,this._y1=t,this._x2=r,this._y2=n,this._inside=i}return Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inside",{get:function(){return this._inside},enumerable:!0,configurable:!0}),e}();r.RectangularClip=Q;var ee=function(){function e(e,t,r){this._scale=e,this._instructions=t,this._inside=r}return Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instructions",{get:function(){return this._instructions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inside",{get:function(){return this._inside},enumerable:!0,configurable:!0}),e}();r.VectorClip=ee;var te=function(){function e(e){this._scale=e}return Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),e}();r.DrawingMode=te;var re=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();r.DrawingBaselineOffset=re;var ne=function(){function e(e){this._instructions=e}return Object.defineProperty(e.prototype,"instructions",{get:function(){return this._instructions},enumerable:!0,configurable:!0}),e}();r.DrawingInstructions=ne;for(var ie=function(e,t){if(!e.prototype.hasOwnProperty("toString")){var r=Object.getOwnPropertyNames(e.prototype).filter((function(e){return"constructor"!==e}));e.prototype.toString=function(){var e=this;return t+" { "+r.map((function(t){return t+": "+e[t]})).join(", ")+(r.length>0?" ":"")+"}"}}},oe=0,ae=Object.keys(r);oe<ae.length;oe++){var se=ae[oe],le=r[se];le instanceof Function&&(ie(le,se),t.registerClass(le))}for(var ue=0,pe=Object.keys(e);ue<pe.length;ue++){se=pe[ue],le=e[se];le instanceof Function&&(ie(le,"Drawing"+se),t.registerClass(le))}})),n("parts/drawing",[],(function(e){var t=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();e.MoveInstruction=t;var r=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();e.LineInstruction=r;var n=function(){function e(e,t,r,n,i,o){this._x1=e,this._y1=t,this._x2=r,this._y2=n,this._x3=i,this._y3=o}return Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x3",{get:function(){return this._x3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y3",{get:function(){return this._y3},enumerable:!0,configurable:!0}),e}();e.CubicBezierCurveInstruction=n})),n("types/misc",[],(function(e){function t(e,t,r,n,i){var o=e.get(t);if(void 0===o)return r(i);try{var a=r(o);if(null!==n&&!n(a))throw new Error("Validation failed.");return a}catch(s){throw new Error("Property "+t+" has invalid value "+o+" - "+s.stack)}}(function(e){e[e["ASS"]=0]="ASS",e[e["SRT"]=1]="SRT"})(e.Format||(e.Format={})),function(e){e[e["SmartWrappingWithWiderTopLine"]=0]="SmartWrappingWithWiderTopLine",e[e["SmartWrappingWithWiderBottomLine"]=3]="SmartWrappingWithWiderBottomLine",e[e["EndOfLineWrapping"]=1]="EndOfLineWrapping",e[e["NoLineWrapping"]=2]="NoLineWrapping"}(e.WrappingStyle||(e.WrappingStyle={})),function(e){e[e["Outline"]=1]="Outline",e[e["OpaqueBox"]=3]="OpaqueBox"}(e.BorderStyle||(e.BorderStyle={})),e.valueOrDefault=t})),n("webworker/index",["webworker/channel","webworker/commands"],(function(t,r,n){n.WorkerCommands=r.WorkerCommands,n.supported=void 0!==e.Worker;var i=void 0!==e.document&&void 0!==e.document.currentScript?e.document.currentScript:null;function o(e){if(void 0===e){if(null===i)throw new Error("Could not auto-detect path of libjass.js, and explicit path was not passed in.");e=i.src}return new t.WorkerChannelImpl(new Worker(e))}n.createWorker=o,void 0!==e.WorkerGlobalScope&&e instanceof e.WorkerGlobalScope&&new t.WorkerChannelImpl(e)})),n("webworker/channel",["serialization","utility/map","utility/promise","webworker/commands","webworker/misc"],(function(e,t,r,n,i,o){var a=function(){function o(e){var r=this;this._comm=e,this._pendingRequests=new t.Map,this._comm.addEventListener("message",(function(e){return r._onMessage(e.data)}),!1)}return o.prototype.request=function(t,n){var i=new r.DeferredPromise,a=++o._lastRequestId;this._pendingRequests.set(a,i);var s={requestId:a,command:t,parameters:n};return this._comm.postMessage(e.serialize(s)),i.promise},o.prototype.cancelRequest=function(e){var t=this._pendingRequests.get(e);void 0!==t&&(this._pendingRequests.delete(e),t.reject(new Error("Cancelled.")))},o.prototype._respond=function(t){var r=t.requestId,i=t.error,o=t.result;i instanceof Error&&(i={message:i.message,stack:i.stack}),this._comm.postMessage(e.serialize({command:n.WorkerCommands.Response,requestId:r,error:i,result:o}))},o.prototype._onMessage=function(t){var r=this,o=e.deserialize(t);if(o.command===n.WorkerCommands.Response){var a=o,s=this._pendingRequests.get(a.requestId);void 0!==s&&(this._pendingRequests.delete(a.requestId),null===a.error?s.resolve(a.result):s.reject(a.error))}else{var l=o,u=l.requestId,p=i.getWorkerCommandHandler(l.command);if(void 0===p)return void this._respond({requestId:u,error:new Error("No handler registered for command "+l.command),result:null});p(l.parameters).then((function(e){return{requestId:u,error:null,result:e}}),(function(e){return{requestId:u,error:e,result:null}})).then((function(e){return r._respond(e)}))}},o._lastRequestId=-1,o}();o.WorkerChannelImpl=a,i.registerWorkerCommand(n.WorkerCommands.Ping,(function(){return r.Promise.resolve(null)}))})),n("webworker/misc",["utility/map"],(function(e,t){var r=new e.Map;function n(e,t){r.set(e,t)}function i(e){return r.get(e)}t.registerWorkerCommand=n,t.getWorkerCommandHandler=i})),n("webworker/commands",[],(function(e){(function(e){e[e["Response"]=0]="Response",e[e["Parse"]=1]="Parse",e[e["Ping"]=2]="Ping"})(e.WorkerCommands||(e.WorkerCommands={}))})),n("serialization",["utility/map"],(function(e,t){var r=new e.Map;function n(e){e.prototype._classTag=r.size,r.set(e.prototype._classTag,e)}function i(e){return JSON.stringify(e,(function(e,t){return t&&void 0!==t._classTag&&!Object.prototype.hasOwnProperty.call(t,"_classTag")&&(t._classTag=t._classTag),t}))}function o(e){return JSON.parse(e,(function(e,t){if(t&&void 0!==t._classTag){var n=r.get(t._classTag);if(void 0===n)throw new Error("Unknown class of tag "+t._classTag+" cannot be deserialized.");if("function"===typeof n.fromJSON)t=n.fromJSON(t);else{for(var i=Object.create(n.prototype),o=0,a=Object.keys(t);o<a.length;o++){e=a[o];i[e]=t[e]}t=i}}return t}))}t.registerClass=n,t.serialize=i,t.deserialize=o})),n("utility/promise",[],(function(t){var r=function(){var t=e.MutationObserver||e.WebkitMutationObserver;if(void 0!==e.process&&"function"===typeof e.process.nextTick){var r=e.process.nextTick;return function(e){r(e)}}if(void 0!==t){var n=[],i=!1,o=document.createElement("div"),a=new t((function(){for(var e=n.splice(0,n.length),t=0,r=e;t<r.length;t++){var a=r[t];a()}i=!1,n.length>0&&(o.classList.toggle("foo"),i=!0)}));return a.observe(o,{attributes:!0}),function(e){n.push(e),i||(o.classList.toggle("foo"),i=!0)}}return function(e){return setTimeout(e,0)}}(),n=function(){function e(e){if(this._state={state:"pending"},this._fulfillReactions=[],this._rejectReactions=[],"function"!==typeof e)throw new TypeError('typeof executor !== "function"');var t=this._createResolvingFunctions(),r=t.resolve,n=t.reject;try{e(r,n)}catch(i){n(i)}}return e.resolve=function(r){return r instanceof e?r:new t.Promise((function(e){return e(r)}))},e.reject=function(e){return new t.Promise((function(t,r){return r(e)}))},e.all=function(e){return new t.Promise((function(r,n){var i=[],o=e.length;0!==o?e.forEach((function(e,a){return t.Promise.resolve(e).then((function(e){i[a]=e,o--,0===o&&r(i)}),n)})):r(i)}))},e.race=function(e){return new t.Promise((function(r,n){for(var i=0,o=e;i<o.length;i++){var a=o[i];t.Promise.resolve(a).then(r,n)}}))},e.prototype.then=function(e,t){var r=new o;"function"!==typeof e&&(e=function(e){return e}),"function"!==typeof t&&(t=function(e){throw e});var n={capabilities:r,handler:e},i={capabilities:r,handler:t};switch(this._state.state){case"pending":this._fulfillReactions.push(n),this._rejectReactions.push(i);break;case"fulfilled":p(n,this._state.value);break;case"rejected":c(i,this._state.reason);break}return r.promise},e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype._createResolvingFunctions=function(){var e=this,t=!1,n=function(n){if(!t)if(t=!0,n!==e)if(null===n||"object"!==typeof n&&"function"!==typeof n)e._fulfill(n);else{var i;try{i=n.then}catch(o){return void e._reject(o)}"function"===typeof i?r((function(){return e._resolveWithThenable(n,i)})):e._fulfill(n)}else e._reject(new TypeError("resolution === this"))},i=function(r){t||(t=!0,e._reject(r))};return{resolve:n,reject:i}},e.prototype._resolveWithThenable=function(e,t){var r=this._createResolvingFunctions(),n=r.resolve,i=r.reject;try{t.call(e,n,i)}catch(o){i(o)}},e.prototype._fulfill=function(e){var t=this._fulfillReactions;this._state={state:"fulfilled",value:e},this._fulfillReactions=[],this._rejectReactions=[];for(var r=0,n=t;r<n.length;r++){var i=n[r];p(i,e)}},e.prototype._reject=function(e){var t=this._rejectReactions;this._state={state:"rejected",reason:e},this._fulfillReactions=[],this._rejectReactions=[];for(var r=0,n=t;r<n.length;r++){var i=n[r];c(i,e)}},e}();function i(e){t.Promise=null!==e?e:n}t.Promise=e.Promise||n,t.setImplementation=i;var o=function(){function e(){var e=this;this._promise=new t.Promise((function(t,r){Object.defineProperties(e,{resolve:{value:t,enumerable:!0},reject:{value:r,enumerable:!0}})}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),e}();function a(e){return s(e,[])}function s(e,r){if(0===e.length)return t.Promise.reject(r);var n=e[0],i=e.slice(1);return n.catch((function(e){return s(i,r.concat(e))}))}function l(e){return new t.Promise((function(r,n){return t.Promise.all(e.map((function(e){return e.then(r,(function(e){return e}))}))).then(n)}))}function u(e,t){return e.then((function(e){return t(),e}),(function(e){throw t(),e}))}function p(e,t){r((function(){var r,n=e.capabilities,i=n.resolve,o=n.reject,a=e.handler;try{r=a(t)}catch(s){return void o(s)}i(r)}))}function c(e,t){r((function(){var r,n=e.capabilities,i=n.resolve,o=n.reject,a=e.handler;try{r=a(t)}catch(s){return void o(s)}i(r)}))}t.DeferredPromise=o,t.first=a,t.any=l,t.lastly=u})),n("utility/map",[],(function(t){var r=function(){function e(e){if(this.clear(),void 0!==e){if(!Array.isArray(e))throw new Error("Non-array iterables are not supported by the SimpleMap constructor.");for(var t=0,r=e;t<r.length;t++){var n=r[t];this.set(n[0],n[1])}}}return e.prototype.get=function(e){var t=i(e);if(null!==t)return this._values[t]},e.prototype.has=function(e){var t=i(e);return null!==t&&t in this._keys},e.prototype.set=function(e,t){var r=i(e);if(null===r)throw new Error("This Map implementation only supports Number and String keys, or keys with an id property.");return r in this._keys||this._size++,this._keys[r]=e,this._values[r]=t,this},e.prototype.delete=function(e){var t=i(e);if(null===t)return!1;var r=t in this._keys;return r&&(delete this._keys[t],delete this._values[t],this._size--),r},e.prototype.clear=function(){this._keys=Object.create(null),this._values=Object.create(null),this._size=0},e.prototype.forEach=function(e,t){for(var r=0,n=Object.keys(this._keys);r<n.length;r++){var i=n[r];e.call(t,this._values[i],this._keys[i],this)}},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e}();function n(e){t.Map=null!==e?e:r}function i(e){return"number"===typeof e?"#"+e:"string"===typeof e?"'"+e:void 0!==e.id?"!"+e.id:null}t.Map=function(){var t=e.Map;if(void 0===t)return r;if("function"!==typeof t.prototype.forEach)return r;try{if(2!==new t([[1,"foo"],[2,"bar"]]).size)return r}catch(n){return r}return t}(),t.setImplementation=n})),n("utility/set",[],(function(t){var r=function(){function e(e){if(this.clear(),void 0!==e){if(!Array.isArray(e))throw new Error("Non-array iterables are not supported by the SimpleSet constructor.");for(var t=0,r=e;t<r.length;t++){var n=r[t];this.add(n)}}}return e.prototype.add=function(e){var t=i(e);if(null===t)throw new Error("This Set implementation only supports Number and String values.");return t in this._elements||this._size++,this._elements[t]=e,this},e.prototype.clear=function(){this._elements=Object.create(null),this._size=0},e.prototype.has=function(e){var t=i(e);return null!==t&&t in this._elements},e.prototype.forEach=function(e,t){for(var r=0,n=Object.keys(this._elements);r<n.length;r++){var i=n[r],o=this._elements[i];e.call(t,o,o,this)}},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e}();function n(e){t.Set=null!==e?e:r}function i(e){return"number"===typeof e?"#"+e:"string"===typeof e?"'"+e:null}t.Set=function(){var t=e.Set;if(void 0===t)return r;if("function"!==typeof t.prototype.forEach)return r;try{if(2!==new t([1,2]).size)return r}catch(n){return r}return t}(),t.setImplementation=n})),n("settings",[],(function(e){function t(t){e.debugMode=t}function r(t){e.verboseMode=t}e.debugMode=!1,e.verboseMode=!1,e.setDebugMode=t,e.setVerboseMode=r})),i("index")}))}}]);
//# sourceMappingURL=chunk-2d0c7b5d.6061f5c4.js.map